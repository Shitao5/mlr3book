<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Applied Machine Learning Using mlr3 in R - 11&nbsp; Large-Scale Benchmarking</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/chapter12/model_interpretation.html" rel="next">
<link href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html" rel="prev">
<link href="../../Figures/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating slimcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html">Advanced Topics</a></li><li class="breadcrumb-item"><a href="../../chapters/chapter11/large-scale_benchmarking.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Large-Scale Benchmarking</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Applied Machine Learning Using mlr3 in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mlr-org/mlr3book/tree/main/book/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../Applied-Machine-Learning-Using-mlr3-in-R.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter1/introduction_and_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter2/data_and_basic_modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter3/evaluation_and_benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Evaluation and Benchmarking</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tuning and Feature Selection</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter4/hyperparameter_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Hyperparameter Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter5/advanced_tuning_methods_and_black_box_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Tuning Methods and Black Box Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter6/feature_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Pipelines and Preprocessing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter7/sequential_pipelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sequential Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter8/non-sequential_pipelines_and_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Non-sequential Pipelines and Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter9/preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Preprocessing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Technical Aspects of mlr3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter11/large-scale_benchmarking.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Large-Scale Benchmarking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter12/model_interpretation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Interpretation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter13/beyond_regression_and_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Beyond Regression and Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter14/algorithmic_fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Algorithmic Fairness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Solutions to exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Tasks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/overview-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Overview Tables</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-openml" id="toc-sec-openml" class="nav-link active" data-scroll-target="#sec-openml"><span class="header-section-number">11.1</span> Getting Data with OpenML</a>
  <ul class="collapse">
<li><a href="#sec-openml-dataset" id="toc-sec-openml-dataset" class="nav-link" data-scroll-target="#sec-openml-dataset"><span class="header-section-number">11.1.1</span> Datasets</a></li>
  <li><a href="#sec-openml-task" id="toc-sec-openml-task" class="nav-link" data-scroll-target="#sec-openml-task"><span class="header-section-number">11.1.2</span> Task</a></li>
  <li><a href="#sec-openml-collection" id="toc-sec-openml-collection" class="nav-link" data-scroll-target="#sec-openml-collection"><span class="header-section-number">11.1.3</span> Task Collection</a></li>
  </ul>
</li>
  <li>
<a href="#sec-hpc-exec" id="toc-sec-hpc-exec" class="nav-link" data-scroll-target="#sec-hpc-exec"><span class="header-section-number">11.2</span> Benchmarking on HPC Clusters</a>
  <ul class="collapse">
<li><a href="#sec-registry" id="toc-sec-registry" class="nav-link" data-scroll-target="#sec-registry"><span class="header-section-number">11.2.1</span> Experiment Registry Setup</a></li>
  <li><a href="#sec-batchtools-submission" id="toc-sec-batchtools-submission" class="nav-link" data-scroll-target="#sec-batchtools-submission"><span class="header-section-number">11.2.2</span> Job Submission</a></li>
  <li><a href="#sec-batchtools-monitoring" id="toc-sec-batchtools-monitoring" class="nav-link" data-scroll-target="#sec-batchtools-monitoring"><span class="header-section-number">11.2.3</span> Job Monitoring, Error Handling, and Result Collection</a></li>
  <li><a href="#sec-custom-experiments" id="toc-sec-custom-experiments" class="nav-link" data-scroll-target="#sec-custom-experiments"><span class="header-section-number">11.2.4</span> Custom Experiments with batchtools</a></li>
  </ul>
</li>
  <li><a href="#sec-benchmark-analysis" id="toc-sec-benchmark-analysis" class="nav-link" data-scroll-target="#sec-benchmark-analysis"><span class="header-section-number">11.3</span> Statistical Analysis</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">11.4</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">11.5</span> Exercises</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation"><span class="header-section-number">11.6</span> Citation</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/mlr-org/mlr3book/edit/main/book/chapters/chapter11/large-scale_benchmarking.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/mlr-org/mlr3book/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/mlr-org/mlr3book/blob/main/book/chapters/chapter11/large-scale_benchmarking.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-large-benchmarking" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Large-Scale Benchmarking</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><strong>Sebastian Fischer</strong> <br><em>Ludwig-Maximilians-Universität München, and Munich Center for Machine Learning (MCML)</em></p>
<p><strong>Michel Lang</strong> <br><em>Research Center Trustworthy Data Science and Security, and TU Dortmund University</em></p>
<p><strong>Marc Becker</strong> <br><em>Ludwig-Maximilians-Universität München, and Munich Center for Machine Learning (MCML)</em> <br><br></p>
<p>In machine learning, it is often difficult to evaluate methods using mathematical analysis alone. Even when formal analyses can be successfully applied, it is often an open question whether real-world datasets satisfy the necessary assumptions for the theorems to hold. Empirical benchmark experiments evaluate the performance of different algorithms on a wide range of datasets. These empirical investigations are essential for understanding the capabilities and limitations of existing methods and for developing new and improved approaches. Trustworthy benchmark experiments are often ‘large-scale’, which means they may make use of many datasets, measures, and learners. Moreover, datasets must span a wide range of domains and problem types as conclusions can only be drawn about the kind of datasets on which the benchmark study was conducted.</p>
<p>Large-scale benchmark experiments consist of three primary steps: sourcing the data for the experiment, executing the experiment, and analyzing the results; we will discuss each of these in turn. In <a href="#sec-openml"><span>Section&nbsp;11.1</span></a> we will begin by discussing <a href="https://mlr3oml.mlr-org.com"><code>mlr3oml</code></a>, which provides an interface between <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> and OpenML <span class="citation" data-cites="openml2013">(<a href="../references.html#ref-openml2013" role="doc-biblioref">Vanschoren et al. 2013</a>)</span>, a popular tool for uploading and downloading datasets. Increasing the number of datasets leads to ‘large-scale’ experiments that may require significant computational resources, so in <a href="#sec-hpc-exec"><span>Section&nbsp;11.2</span></a> we will introduce <a href="https://mlr3batchmark.mlr-org.com"><code>mlr3batchmark</code></a>, which connects <code>mlr3</code> with <a href="https://cran.r-project.org/package=batchtools"><code>batchtools</code></a> <span class="citation" data-cites="batchtools">(<a href="../references.html#ref-batchtools" role="doc-biblioref">Lang, Bischl, and Surmann 2017</a>)</span>, which provides methods for managing and executing experiments on high-performance computing (HPC) clusters. Finally, in <a href="#sec-benchmark-analysis"><span>Section&nbsp;11.3</span></a> we will demonstrate how to make use of <a href="https://mlr3benchmark.mlr-org.com"><code>mlr3benchmark</code></a> to formally analyze the results from large-scale benchmark experiments.</p>
<p>Throughout this chapter, we will use the running example of benchmarking a random forest model against a logistic regression as in <span class="citation" data-cites="couronne2018random">Couronné, Probst, and Boulesteix (<a href="../references.html#ref-couronne2018random" role="doc-biblioref">2018</a>)</span>. We will also assume that you have read <a href="../chapter7/sequential_pipelines.html"><span>Chapter&nbsp;7</span></a> and <a href="../chapter10/advanced_technical_aspects_of_mlr3.html"><span>Chapter&nbsp;10</span></a>. We make use of <code>ppl("robustify")</code> (<a href="../chapter9/preprocessing.html#sec-prepro-robustify"><span>Section&nbsp;9.4</span></a>) for automating common preprocessing steps. We also set a featureless baseline as a fallback learner (<a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-fallback"><span>Section&nbsp;10.2.2</span></a>) and set <code>"try"</code> as our encapsulation method (<a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-encapsulation"><span>Section&nbsp;10.2.1</span></a>), which logs errors/warnings to an external file that can be read by <code>batchtools</code> (we will return to this in <a href="#sec-batchtools-monitoring"><span>Section&nbsp;11.2.3</span></a>).</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-002_85d824ce64a45ce4b6e0085f97737718">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># featureless baseline</span></span>
<span><span class="va">lrn_baseline</span> <span class="op">=</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.featureless"</span>, id <span class="op">=</span> <span class="st">"featureless"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># logistic regression pipeline</span></span>
<span><span class="va">lrn_lr</span> <span class="op">=</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.log_reg"</span><span class="op">)</span></span>
<span><span class="va">lrn_lr</span> <span class="op">=</span> <span class="fu">as_learner</span><span class="op">(</span><span class="fu">ppl</span><span class="op">(</span><span class="st">"robustify"</span>, learner <span class="op">=</span> <span class="va">lrn_lr</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="va">lrn_lr</span><span class="op">)</span></span>
<span><span class="va">lrn_lr</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"logreg"</span></span>
<span><span class="va">lrn_lr</span><span class="op">$</span><span class="va">fallback</span> <span class="op">=</span> <span class="va">lrn_baseline</span></span>
<span><span class="va">lrn_lr</span><span class="op">$</span><span class="va">encapsulate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"try"</span>, predict <span class="op">=</span> <span class="st">"try"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># random forest pipeline</span></span>
<span><span class="va">lrn_rf</span> <span class="op">=</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.ranger"</span><span class="op">)</span></span>
<span><span class="va">lrn_rf</span> <span class="op">=</span> <span class="fu">as_learner</span><span class="op">(</span><span class="fu">ppl</span><span class="op">(</span><span class="st">"robustify"</span>, learner <span class="op">=</span> <span class="va">lrn_rf</span><span class="op">)</span> <span class="op">%&gt;&gt;%</span> <span class="va">lrn_rf</span><span class="op">)</span></span>
<span><span class="va">lrn_rf</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="st">"ranger"</span></span>
<span><span class="va">lrn_rf</span><span class="op">$</span><span class="va">fallback</span> <span class="op">=</span> <span class="va">lrn_baseline</span></span>
<span><span class="va">lrn_rf</span><span class="op">$</span><span class="va">encapsulate</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"try"</span>, predict <span class="op">=</span> <span class="st">"try"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">learners</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lrn_lr</span>, <span class="va">lrn_rf</span>, <span class="va">lrn_baseline</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As a starting example, we will compare our learners across three classification tasks using accuracy and three-fold CV.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-2_b51de2585f6c6262641c2aef0ce66c39">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">design</span> <span class="op">=</span> <span class="fu">benchmark_grid</span><span class="op">(</span><span class="fu">tsks</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"german_credit"</span>, <span class="st">"sonar"</span>, <span class="st">"pima"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">learners</span>, <span class="fu">rsmp</span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bmr</span> <span class="op">=</span> <span class="fu">benchmark</span><span class="op">(</span><span class="va">design</span><span class="op">)</span></span>
<span><span class="va">bmr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="fu">msr</span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">task_id</span>, <span class="va">learner_id</span>, <span class="va">classif.acc</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         task_id  learner_id classif.acc
1: german_credit      logreg      0.7460
2: german_credit      ranger      0.7630
3: german_credit featureless      0.7000
4:         sonar      logreg      0.7162
5:         sonar      ranger      0.8412
6:         sonar featureless      0.5329
7:          pima      logreg      0.7747
8:          pima      ranger      0.7618
9:          pima featureless      0.6511</code></pre>
</div>
</div>
<p>In this small experiment, random forests appears to outperform the other learners on all three datasets. However, this analysis is not conclusive as we only considered three tasks, and the performance differences might not be statistically significant. In the following, we will introduce some techniques to improve the study.</p>
<section id="sec-openml" class="level2 page-columns page-full" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="sec-openml">
<span class="header-section-number">11.1</span> Getting Data with OpenML</h2>
<div class="page-columns page-full"><p>To draw meaningful conclusions from benchmark experiments, a good choice of datasets and tasks is essential. OpenML is an open-source platform that facilitates the sharing and dissemination of machine learning research data, algorithms, and experimental results, in a standardized format enabling consistent cross-study comparison. OpenML’s design ensures that all data on the platform is ‘FAIR’ (<strong>F</strong>indability, <strong>A</strong>ccessibility, <strong>I</strong>nteroperability and <strong>R</strong>eusability), which ensures the data is easily discoverable and reusable. All entities on the platform have unique identifiers and standardized (meta)data that can be accessed via a REST API or the web interface.</p><div class="no-row-height column-margin column-container"><span class="">OpenML</span></div></div>
<p>In this section, we will cover some of the main features of OpenML and how to use them via the <a href="https://mlr3oml.mlr-org.com"><code>mlr3oml</code></a> interface package. In particular, we will discuss OpenML datasets, tasks, and task collections, but will not cover algorithms or experiment results here.</p>
<section id="sec-openml-dataset" class="level3 page-columns page-full" data-number="11.1.1"><h3 data-number="11.1.1" class="anchored" data-anchor-id="sec-openml-dataset">
<span class="header-section-number">11.1.1</span> Datasets</h3>
<p>Finding data from OpenML is possible via the website or its REST API that <code>mlr3oml</code> interfaces. <a href="https://mlr3oml.mlr-org.com/reference/list_oml.html"><code>list_oml_data()</code></a> can be used to filter datasets for specific properties, for example by number of features, rows, or number of classes in a classification problem:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-014_5c6b612d184cb7b4569b2299b451ba3b">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3oml.mlr-org.com">mlr3oml</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">odatasets</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_data</a></span><span class="op">(</span></span>
<span>  number_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  number_instances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45000</span>, <span class="fl">50000</span><span class="op">)</span>,</span>
<span>  number_classes <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-5_881152051b0b1cdbe9d0818b505c0fd7">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">odatasets</span><span class="op">[</span><span class="va">NumberOfFeatures</span> <span class="op">&lt;</span> <span class="fl">16</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data_id"</span>, <span class="st">"name"</span>, <span class="st">"NumberOfFeatures"</span>, <span class="st">"NumberOfInstances"</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   data_id       name NumberOfFeatures NumberOfInstances
1:     179      adult               15             48842
2:    1590      adult               15             48842
3:   43898      adult               15             48790
4:   45051 adult-test               15             48842
5:   45068      adult               15             48842</code></pre>
</div>
</div>
<p>Note that <code><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_data()</a></code> returns a <code>data.table</code> with many more meta-features than shown here; this table can itself be used to filter further.</p>
<div class="page-columns page-full"><p>We can see that some datasets have duplicated names, which is why each dataset also has a unique ID. By example, let us consider the ‘adult’ dataset with ID 1590. Metadata for the dataset is loaded with <a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>odt()</code></a>, which returns an object of class <a href="https://mlr3oml.mlr-org.com/reference/oml_data.html"><code>OMLData</code></a>.</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">odt()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-003_b8166662fbcd65082506f227ffe469b4">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">odata</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">1590</span><span class="op">)</span></span>
<span><span class="va">odata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;OMLData:1590:adult&gt; (48842x15)
 * Default target: class</code></pre>
</div>
</div>
<p>The <code>OMLData</code> object contains metadata about the dataset but importantly does not (yet) contain the data. This means that information about the dataset can be queried without having to load the entire data into memory, for example, the license and dimension of the data:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-004_4a569d0f9fce77571db0f71d9d5cf706">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">odata</span><span class="op">$</span><span class="va">license</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Public"</code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">odata</span><span class="op">$</span><span class="va">nrow</span>, ncol <span class="op">=</span> <span class="va">odata</span><span class="op">$</span><span class="va">ncol</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> nrow  ncol 
48842    15 </code></pre>
</div>
</div>
<p>If we want to work with the actual data, then accessing the <code>$data</code> field will download the data, import it into R, and then store the <code>data.frame</code> in the <code>OMLData</code> object:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-005_c9de409756102d886e56445d674b3368">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># first 5 rows and columns</span></span>
<span><span class="va">odata</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   age workclass fnlwgt    education education.num
1:  25   Private 226802         11th             7
2:  38   Private  89814      HS-grad             9
3:  28 Local-gov 336951   Assoc-acdm            12
4:  44   Private 160323 Some-college            10
5:  18      &lt;NA&gt; 103497 Some-college            10</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
mlr3oml Cache
</div>
</div>
<div class="callout-body-container callout-body">
<p>After <code>$data</code> has been called the first time, all subsequent calls to <code>$data</code> will be transparently redirected to the in-memory <code>data.frame</code>. Additionally, many objects can be permanently cached on the local file system by setting the option <code>mlr3oml.cache</code> to either <code>TRUE</code> or to a specific path to be used as the cache folder.</p>
</div>
</div>
<p>Data can then be converted into <code>mlr3</code> backends (see <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-backends"><span>Section&nbsp;10.4</span></a>) with the <a href="https://mlr3.mlr-org.com/reference/as_data_backend.Matrix.html"><code>as_data_backend()</code></a> function and then into tasks:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-006_b3b165d3af7319cc0fd54bd2d7f4ed53">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">backend</span> <span class="op">=</span> <span class="fu">as_data_backend</span><span class="op">(</span><span class="va">odata</span><span class="op">)</span></span>
<span><span class="va">tsk_adult</span> <span class="op">=</span> <span class="fu">as_task_classif</span><span class="op">(</span><span class="va">backend</span>, target <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">tsk_adult</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:backend&gt; (48842 x 15)
* Target: class
* Properties: twoclass
* Features (14):
  - fct (8): education, marital.status, native.country,
    occupation, race, relationship, sex, workclass
  - int (6): age, capital.gain, capital.loss, education.num,
    fnlwgt, hours.per.week</code></pre>
</div>
</div>
<p>Some datasets on OpenML contain columns that should neither be used as a feature nor a target. The column names that are usually included as features are accessible through the field <code>$feature_names</code>, and we assign them to the <code>mlr3</code> task accordingly. Note that for the dataset at hand, this would not have been necessary, as all non-target columns are to be treated as predictors, but we include it for clarity.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-6_0e39a880ee298066fad6779a322ee7e0">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_adult</span><span class="op">$</span><span class="va">col_roles</span><span class="op">$</span><span class="va">feature</span> <span class="op">=</span> <span class="va">odata</span><span class="op">$</span><span class="va">feature_names</span></span>
<span><span class="va">tsk_adult</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:backend&gt; (48842 x 15)
* Target: class
* Properties: twoclass
* Features (14):
  - fct (8): education, marital.status, native.country,
    occupation, race, relationship, sex, workclass
  - int (6): age, capital.gain, capital.loss, education.num,
    fnlwgt, hours.per.week</code></pre>
</div>
</div>
</section><section id="sec-openml-task" class="level3 page-columns page-full" data-number="11.1.2"><h3 data-number="11.1.2" class="anchored" data-anchor-id="sec-openml-task">
<span class="header-section-number">11.1.2</span> Task</h3>
<p>OpenML tasks are built on top of OpenML datasets and additionally specify the target variable, the train-test splits to use for resampling, and more. Note that this differs from <code>mlr3</code> <code>Task</code> objects, which do not contain information about the resampling procedure. Similarly to <code>mlr3</code>, OpenML has different types of tasks, such as regression and classification. Analogously to filtering datasets, tasks can be filtered with <a href="https://mlr3oml.mlr-org.com/reference/list_oml.html"><code>list_oml_tasks()</code></a>. To find a task that makes use of the data we have been using, we would pass the data ID to the <code>data_id</code> argument:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-8_0a8b19ab6dd81b0829122a6156ee8459">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># tasks making use of the adult data</span></span>
<span><span class="va">adult_tasks</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_tasks</a></span><span class="op">(</span>data_id <span class="op">=</span> <span class="fl">1590</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-10_7bece9bdaaffc5e4de122b72c6c9894e">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adult_tasks</span><span class="op">[</span><span class="va">task_type</span> <span class="op">==</span> <span class="st">"Supervised Classification"</span>, <span class="va">task_id</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   7592  14947 126025 146154 146598 168878 233099 359983 361515</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>From these tasks, we randomly select the task with ID 359983. We can load the object using <a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>otsk()</code></a>, which returns an <a href="https://mlr3oml.mlr-org.com/reference/oml_task.html"><code>OMLTask</code></a> object.</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">otsk()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-009_f84d66184eb60606854feb6f9bc66d7d">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">otsk</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">359983</span><span class="op">)</span></span>
<span><span class="va">otask</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;OMLTask:359983&gt;
 * Type: Supervised Classification
 * Data: adult (id: 1590; dim: 48842x15)
 * Target: class
 * Estimation: crossvalidation (id: 1; repeats: 1, folds: 10)</code></pre>
</div>
</div>
<p>The <code>OMLData</code> object associated with the underlying dataset can be accessed through the <code>$data</code> field.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-010_f933945c6bd8101464c02691d6781841">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask</span><span class="op">$</span><span class="va">data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;OMLData:1590:adult&gt; (48842x15)
 * Default target: class</code></pre>
</div>
</div>
<p>The data splits associated with the estimation procedure are accessible through the field <code>$task_splits</code>. In <code>mlr3</code> terms, these are the instantiation of a <a href="https://mlr3.mlr-org.com/reference/Resampling.html"><code>Resampling</code></a> on a specific <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a>.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-011_30e8ba694b981d921a72fa34394c69d6">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask</span><span class="op">$</span><span class="va">task_splits</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         type rowid repeat. fold
     1: TRAIN 32427       0    0
     2: TRAIN 13077       0    0
     3: TRAIN 15902       0    0
     4: TRAIN 17703       0    0
     5: TRAIN 35511       0    0
    ---                         
488416:  TEST  8048       0    9
488417:  TEST 12667       0    9
488418:  TEST 43944       0    9
488419:  TEST 25263       0    9
488420:  TEST 43381       0    9</code></pre>
</div>
</div>
<p>The OpenML task can be converted to both an <code><a href="https://mlr3.mlr-org.com/reference/Task.html">mlr3::Task</a></code> and <a href="https://mlr3.mlr-org.com/reference/ResamplingCustom.html"><code>ResamplingCustom</code></a> instantiated on the task using <a href="https://mlr3.mlr-org.com/reference/as_task.html"><code>as_task()</code></a> and <a href="https://mlr3.mlr-org.com/reference/as_resampling.html"><code>as_resampling()</code></a>, respectively:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-012_0791a46f673659f52c1318de2bb81758">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_adult</span> <span class="op">=</span> <span class="fu">as_task</span><span class="op">(</span><span class="va">otask</span><span class="op">)</span></span>
<span><span class="va">tsk_adult</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:adult&gt; (48842 x 15)
* Target: class
* Properties: twoclass
* Features (14):
  - fct (8): education, marital.status, native.country,
    occupation, race, relationship, sex, workclass
  - int (6): age, capital.gain, capital.loss, education.num,
    fnlwgt, hours.per.week</code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">resampling</span> <span class="op">=</span> <span class="fu">as_resampling</span><span class="op">(</span><span class="va">otask</span><span class="op">)</span></span>
<span><span class="va">resampling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ResamplingCustom&gt;: Custom Splits
* Iterations: 10
* Instantiated: TRUE
* Parameters: list()</code></pre>
</div>
</div>
<p><code>mlr3oml</code> also allows direct construction of <code>mlr3</code> tasks and resamplings with the standard <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>tsk()</code></a> and <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>rsmp()</code></a> constructors, e.g.:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-11_41bcd02f52995d0182619e3f0022dffe">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tsk</span><span class="op">(</span><span class="st">"oml"</span>, task_id <span class="op">=</span> <span class="fl">359983</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:adult&gt; (48842 x 15)
* Target: class
* Properties: twoclass
* Features (14):
  - fct (8): education, marital.status, native.country,
    occupation, race, relationship, sex, workclass
  - int (6): age, capital.gain, capital.loss, education.num,
    fnlwgt, hours.per.week</code></pre>
</div>
</div>
</section><section id="sec-openml-collection" class="level3 page-columns page-full" data-number="11.1.3"><h3 data-number="11.1.3" class="anchored" data-anchor-id="sec-openml-collection">
<span class="header-section-number">11.1.3</span> Task Collection</h3>
<div class="page-columns page-full"><p>The OpenML task collection is a container object bundling existing tasks. This allows for the creation of benchmark suites, which are curated collections of tasks that satisfy certain quality criteria. Examples include the OpenML CC-18 benchmark suite <span class="citation" data-cites="bischl2021openml">(<a href="../references.html#ref-bischl2021openml" role="doc-biblioref">Bischl et al. 2021</a>)</span>, the AutoML benchmark <span class="citation" data-cites="amlb2022">(<a href="../references.html#ref-amlb2022" role="doc-biblioref">Gijsbers et al. 2022</a>)</span> and the benchmark for tabular deep learning <span class="citation" data-cites="grinsztajn2022why">(<a href="../references.html#ref-grinsztajn2022why" role="doc-biblioref">Grinsztajn, Oyallon, and Varoquaux 2022</a>)</span>. <a href="https://mlr3oml.mlr-org.com/reference/oml_collection.html"><code>OMLCollection</code></a> objects are loaded with <a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>ocl()</code></a>, by example we will look at CC-18, which has ID 99:</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">ocl()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-017_7347b817f48f7b4ec11411d014ff00e0">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask_collection</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html">ocl</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">99</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-019_9ac392d222fe257f44cd2b7d33f1ae72">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask_collection</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;OMLCollection: 99&gt; OpenML-CC18 Curated Class[...]
 * data:  72
 * tasks: 72</code></pre>
</div>
</div>
<p>The task includes 72 classification tasks on different datasets that can be accessed through <code>$task_ids</code>:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-020_d050fecfe7aa231b0afa70405c7d09e6">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">otask_collection</span><span class="op">$</span><span class="va">task_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co"># first 5 tasks in the collection</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  3  6 11 12 14</code></pre>
</div>
</div>
<p>Task collections can be used to quickly define benchmark experiments in <code>mlr3</code>. To easily construct all tasks and resamplings from the benchmarking suite, you can use <a href="https://mlr3.mlr-org.com/reference/as_task.html"><code>as_tasks()</code></a> and <a href="https://mlr3.mlr-org.com/reference/as_resampling.html"><code>as_resamplings()</code></a> respectively:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-14_3f329b04c165fd2422892b1c3052938f">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tasks</span> <span class="op">=</span> <span class="fu">as_tasks</span><span class="op">(</span><span class="va">otask_collection</span><span class="op">)</span></span>
<span><span class="va">resamplings</span> <span class="op">=</span> <span class="fu">as_resamplings</span><span class="op">(</span><span class="va">otask_collection</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, if we wanted to filter the collection further, say to a binary classification experiment with six tasks, we could run <a href="https://mlr3oml.mlr-org.com/reference/list_oml.html"><code>list_oml_tasks()</code></a> with the task IDs from the CC-18 collection as argument <code>task_id</code>. We can either use the <code><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_tasks()</a></code> argument to request the number of classes to be <code>2</code>, or we can make use of the fact that the result of <code><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_tasks()</a></code> is a <code>data.table</code> and subset the resulting table.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-021_73a5368c71fe94a4d859906aaee1f504">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">binary_cc18</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/list_oml.html">list_oml_tasks</a></span><span class="op">(</span></span>
<span>  limit <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  task_id <span class="op">=</span> <span class="va">otask_collection</span><span class="op">$</span><span class="va">task_ids</span>,</span>
<span>  number_classes <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now define the tasks and resamplings which we will use for comparing the logistic regression with the random forest learner. Note that all resamplings in this collection consist of exactly 10 iterations.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-024_e00ce9dae8aef08ae63056e44fd3a96f">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># load tasks as a list</span></span>
<span><span class="va">otasks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">binary_cc18</span><span class="op">$</span><span class="va">task_id</span>, <span class="va">otsk</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to mlr3 tasks and resamplings</span></span>
<span><span class="va">tasks</span> <span class="op">=</span> <span class="fu">as_tasks</span><span class="op">(</span><span class="va">otasks</span><span class="op">)</span></span>
<span><span class="va">resamplings</span> <span class="op">=</span> <span class="fu">as_resamplings</span><span class="op">(</span><span class="va">otasks</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To define the design table, we use <a href="https://mlr3.mlr-org.com/reference/benchmark_grid.html"><code>benchmark_grid()</code></a> and set <code>paired</code> to <code>TRUE</code>, which is used in situations where each resampling is instantiated on a corresponding task (therefore the <code>tasks</code> and <code>resamplings</code> below must have the same length) and each learner should be evaluated on every resampled task.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-025_da6ca424e1d070dc285d0cca86d58ff8">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">large_design</span> <span class="op">=</span> <span class="fu">benchmark_grid</span><span class="op">(</span><span class="va">tasks</span>, <span class="va">learners</span>, <span class="va">resamplings</span>,</span>
<span>  paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">large_design</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="co"># first 6 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       task     learner resampling
1: kr-vs-kp      logreg     custom
2: kr-vs-kp      ranger     custom
3: kr-vs-kp featureless     custom
4: breast-w      logreg     custom
5: breast-w      ranger     custom
6: breast-w featureless     custom</code></pre>
</div>
</div>
<p>Having set up our large experiment, we can now look at how to efficiently carry it out on a cluster.</p>
</section></section><section id="sec-hpc-exec" class="level2 page-columns page-full" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="sec-hpc-exec">
<span class="header-section-number">11.2</span> Benchmarking on HPC Clusters</h2>
<div class="page-columns page-full"><p>As discussed in <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-parallelization"><span>Section&nbsp;10.1</span></a>, parallelization of benchmark experiments is straightforward as they are embarrassingly parallel. However, for large experiments, parallelization on a high-performance computing (HPC) cluster is often preferable. <a href="https://cran.r-project.org/package=batchtools"><code>batchtools</code></a> provides a framework to simplify running large batches of computational experiments in parallel from R on such sites. It is highly flexible, making it suitable for a wide range of computational experiments, including machine learning, optimization, simulation, and more.</p><div class="no-row-height column-margin column-container"><span class="">High-performance Computing</span></div></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>"batchtools"</code> backend for <code>future</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-parallel-resample"><span>Section&nbsp;10.1.2</span></a> we touched upon different parallelization backends. The package <a href="https://cran.r-project.org/package=future"><code>future</code></a> includes a <code>"batchtools"</code> plan, however, this does not allow the additional control that comes with working with <code>batchtools</code> directly.</p>
</div>
</div>
<p>An HPC cluster is a collection of interconnected computers or servers providing computational power beyond what a single computer can achieve. HPC clusters typically consist of multiple compute nodes, each with multiple CPU/GPU cores, memory, and local storage. These nodes are usually connected by a high-speed network and network file system which enables the nodes to communicate and work together on a given task. The most important difference between HPC clusters and a personal computer (PC), is that the nodes often cannot be accessed directly, but instead, computational jobs are queued by a scheduling system such as Slurm (Simple Linux Utility for Resource Management). A scheduling system is a software tool that orchestrates the allocation of computing resources to users or applications on the cluster. It ensures that multiple users and applications can access the resources of the cluster fairly and efficiently, and also helps to maximize the utilization of the computing resources.</p>
<p><a href="#fig-hpc">Figure&nbsp;<span>11.1</span></a> contains a rough sketch of an HPC architecture. Multiple users can log into the head node (typically via SSH) and add their computational jobs to the queue by sending a command of the form “execute computation X using resources Y for Z amount of time”. The scheduling system controls when these computational jobs are executed.</p>
<p>For the rest of this section, we will look at how to use <code>batchtools</code> and <a href="https://mlr3batchmark.mlr-org.com"><code>mlr3batchmark</code></a> for submitting jobs, adapting jobs to clusters, ensuring reproducibility, querying job status, and debugging failures.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/fig-hpc_d4526d171ff4481b9c1fbc9b3963d04c">
<div class="cell-output-display">
<div id="fig-hpc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/mlr3book_figures-32.svg" class="img-fluid figure-img" style="width:100.0%" alt="Flow diagram of objects. Left is a laptop with an arrow to an object that says 'Head Node - Scheduler', the arrow has text 'SSH'. The scheduler has a bidirectional arrow with text 'Submit' to 'Queue' that has an arrow to 'Computing Nodes'. The scheduler also has an arrow to 'File System' which has a double arrow connecting it to/from the 'Computing Nodes' object with text 'Data'."></p>
<figcaption class="figure-caption">Figure&nbsp;11.1: Illustration of an HPC cluster architecture.</figcaption></figure>
</div>
</div>
</div>
<section id="sec-registry" class="level3 page-columns page-full" data-number="11.2.1"><h3 data-number="11.2.1" class="anchored" data-anchor-id="sec-registry">
<span class="header-section-number">11.2.1</span> Experiment Registry Setup</h3>
<p><code>batchtools</code> is built around experiments or ‘jobs’. One replication of a job is defined by applying a (parameterized) algorithm to a (parameterized) problem. A benchmark experiment in <code>batchtools</code> consists of running many such experiments with different algorithms, algorithm parameters, problems, and problem parameters. Each such experiment is computationally independent of all other experiments and constitutes the basic level of computation <code>batchtools</code> can parallelize. For this section, we will define a single <code>batchtools</code> experiment as one resampling iteration of one learner on one task, in <a href="#sec-custom-experiments"><span>Section&nbsp;11.2.4</span></a> we will look at different ways of defining an experiment.</p>
<p>The first step in running an experiment is to create or load an experiment registry with <a href="https://www.rdocumentation.org/packages/batchtools/topics/makeExperimentRegistry"><code>makeExperimentRegistry()</code></a> or <a href="https://www.rdocumentation.org/packages/batchtools/topics/loadRegistry"><code>loadRegistry()</code></a> respectively. This constructs the inter-communication object for all functions in <code>batchtools</code> and corresponds to a folder on the file system. Among other things, the experiment registry stores the algorithms, problems, and job definitions; log outputs and status of submitted, running, and finished jobs; job results; and the “cluster function” that defines the interaction with the scheduling system in a scheduling-software-agnostic way.</p>
<p>Below, we create a registry in a subdirectory of our working directory – on a real cluster, make sure that this folder is stored on a shared network filesystem, otherwise, the nodes cannot access it. We also set the registry’s <code>seed</code> to <code>1</code> and the <code>packages</code> to <code>"mlr3verse"</code>, which will make these packages available in all our experiments.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mllg/batchtools">batchtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create registry</span></span>
<span><span class="va">reg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/makeExperimentRegistry.html">makeExperimentRegistry</a></span><span class="op">(</span></span>
<span>  file.dir <span class="op">=</span> <span class="st">"./experiments"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  packages <span class="op">=</span> <span class="st">"mlr3verse"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full"><p>Once the registry has been created, we need to populate it with problems and algorithms to form the jobs, this is most easily carried out with <code>mlr3batchmark</code>, although finer control is possible with <code>batchtools</code> and will be explored in <a href="#sec-custom-experiments"><span>Section&nbsp;11.2.4</span></a>. <a href="https://mlr3batchmark.mlr-org.com/reference/batchmark.html"><code>batchmark()</code></a> converts <code>mlr3</code> tasks and resamplings to <code>batchtools</code> problems, and converts <code>mlr3</code> learners to <code>batchtools</code> algorithms; jobs are then created for all resampling iterations.</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https:///mlr3batchmark.mlr-org.com/reference/batchmark.html">batchmark()</a></code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https:///mlr3batchmark.mlr-org.com">mlr3batchmark</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https:///mlr3batchmark.mlr-org.com/reference/batchmark.html">batchmark</a></span><span class="op">(</span><span class="va">large_design</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the registry includes six problems, one for each resampled task, and <span class="math inline">\(180\)</span> jobs from <span class="math inline">\(3\)</span> learners <span class="math inline">\(\times\)</span> <span class="math inline">\(6\)</span> tasks <span class="math inline">\(\times\)</span> <span class="math inline">\(10\)</span> resampling iterations. The single algorithm in the registry is because <code>mlr3batchmark</code> specifies a single algorithm that is parametrized with the learner IDs.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-030_465f89410b6d6d203ca96a59a78ede7c">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Experiment Registry
  Backend   : Interactive
  File dir  : /home/runner/work/mlr3book/mlr3book/book/chapters/chapter11/experiments
  Work dir  : /home/runner/work/mlr3book/mlr3book/book/chapters/chapter11
  Jobs      : 180
  Problems  : 6
  Algorithms: 1
  Seed      : 1
  Writeable : TRUE</code></pre>
</div>
</div>
<p>By default, the “Interactive” cluster function (see <a href="https://www.rdocumentation.org/packages/batchtools/topics/makeClusterFunctionsInteractive"><code>makeClusterFunctionsInteractive()</code></a>) is used – this is the abstraction for the scheduling system, and “interactive” here means to not use a real scheduler but instead to use the interactive R session for sequential computation. <a href="https://www.rdocumentation.org/packages/batchtools/topics/getJobTable"><code>getJobTable()</code></a> can be used to get more detailed information about the jobs. Here, we only show a few selected columns for readability and unpack the list columns <code>algo.pars</code> and <code>prob.pars</code> using <a href="https://www.rdocumentation.org/packages/batchtools/topics/unwrap"><code>unwrap()</code></a>.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-032_9fd11c435dc30d3cba920a0ce4a411e2">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">job_table</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/getJobTable.html">getJobTable</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">job_table</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/unwrap.html">unwrap</a></span><span class="op">(</span><span class="va">job_table</span><span class="op">)</span></span>
<span><span class="va">job_table</span> <span class="op">=</span> <span class="va">job_table</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">job.id</span>, <span class="va">learner_id</span>, <span class="va">task_id</span>, <span class="va">resampling_id</span>, <span class="va">repl</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">job_table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     job.id  learner_id  task_id resampling_id repl
  1:      1      logreg kr-vs-kp        custom    1
  2:      2      logreg kr-vs-kp        custom    2
  3:      3      logreg kr-vs-kp        custom    3
  4:      4      logreg kr-vs-kp        custom    4
  5:      5      logreg kr-vs-kp        custom    5
 ---                                               
176:    176 featureless spambase        custom    6
177:    177 featureless spambase        custom    7
178:    178 featureless spambase        custom    8
179:    179 featureless spambase        custom    9
180:    180 featureless spambase        custom   10</code></pre>
</div>
</div>
<p>In this output, we can see how each job is now assigned a unique <code>job.id</code> and that each row corresponds to a single iteration (column <code>repl</code>) of a resample experiment.</p>
</section><section id="sec-batchtools-submission" class="level3 page-columns page-full" data-number="11.2.2"><h3 data-number="11.2.2" class="anchored" data-anchor-id="sec-batchtools-submission">
<span class="header-section-number">11.2.2</span> Job Submission</h3>
<div class="page-columns page-full"><p>With the experiments defined, we can now submit them to the cluster. However, it is best practice to first test each algorithm individually using <a href="https://www.rdocumentation.org/packages/batchtools/topics/testJob"><code>testJob()</code></a>. By example, we will only test the first job (<code>id = 1</code>) and will use an external R session (<code>external = TRUE</code>).</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://rdrr.io/pkg/batchtools/man/testJob.html">testJob()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-033_ecfffb3cfb0248ef5b1371d3510d712d">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/testJob.html">testJob</a></span><span class="op">(</span><span class="fl">1</span>, external <span class="op">=</span> <span class="cn">TRUE</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we are confident that the jobs are defined correctly (see <a href="#sec-batchtools-monitoring"><span>Section&nbsp;11.2.3</span></a> for jobs with errors), we can proceed with their submission, by specifying the resource requirements for each computational job and then optionally grouping jobs.</p>
<p>Configuration of resources is dependent on the cluster function set in the registry. We will assume we are working with a Slurm cluster and accordingly initialize the cluster function with <a href="https://www.rdocumentation.org/packages/batchtools/topics/makeClusterFunctionsSlurm"><code>makeClusterFunctionsSlurm()</code></a> and will make use of the <code>slurm-simple.tml</code> template file that can be found in a subdirectory of the <code>batchtools</code> package itself (the exact location can be found by running <code>system.file("templates", package = "batchtools")</code>), or the <code>batchtools</code> GitHub repository. A template file is a shell script with placeholders filled in by <code>batchtools</code> and contains the command to start the computation via <code>Rscript</code> or <code>R CMD batch</code>, as well as comments which serve as annotations for the scheduler, for example, to communicate resources or paths on the file system.</p>
<p>The exemplary template should work on many Slurm installations out-of-the-box, but you might have to modify it for your cluster – it can be customized to work with more advanced configurations.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-034_5a7f0853a98ae17b8a6f3820343c621c">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/makeClusterFunctionsSlurm.html">makeClusterFunctionsSlurm</a></span><span class="op">(</span>template <span class="op">=</span> <span class="st">"slurm-simple"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To proceed with the examples on a local machine, we recommend setting the cluster function to a Socket backend with <a href="https://www.rdocumentation.org/packages/batchtools/topics/makeClusterFunctionsSocket"><code>makeClusterFunctionsSocket()</code></a>. The chosen cluster function can be saved to the registry by passing it to the <code>$cluster.functions</code> field.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg</span><span class="op">$</span><span class="va">cluster.functions</span> <span class="op">=</span> <span class="va">cf</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/saveRegistry.html">saveRegistry</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the registry setup, we can now decide if we want to run the experiments in chunks (<a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-parallelization"><span>Section&nbsp;10.1</span></a>) and then specify the resource requirements for the submitted jobs.</p>
<div class="page-columns page-full"><p>For this example, we will use <a href="https://www.rdocumentation.org/packages/batchtools/topics/chunk"><code>chunk()</code></a> to chunk the jobs such that five iterations of one resample experiment are run sequentially in one computational job – in practice the optimal grouping will be highly dependent on your experiment (<a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-parallelization"><span>Section&nbsp;10.1</span></a>).</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://rdrr.io/pkg/batchtools/man/chunk.html">chunk()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-037_459653ec25e9a19e16b9bdac720ca1dc">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">=</span> <span class="va">job_table</span><span class="op">$</span><span class="va">job.id</span></span>
<span><span class="va">chunks</span> <span class="op">=</span> <span class="fu">data.table</span><span class="op">(</span></span>
<span>  job.id <span class="op">=</span> <span class="va">ids</span>, chunk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/chunk.html">chunk</a></span><span class="op">(</span><span class="va">ids</span>, chunk.size <span class="op">=</span> <span class="fl">5</span>, shuffle <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">chunks</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="co"># first 6 jobs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   job.id chunk
1:      1     1
2:      2     1
3:      3     1
4:      4     1
5:      5     1
6:      6     2</code></pre>
</div>
</div>
<p>The final step is to decide the resource requirements for each job. The set of resources depends on your cluster and the corresponding template file. If you are unsure about the resource requirements, you can start a subset of jobs with liberal resource constraints, e.g.&nbsp;the maximum runtime allowed for your computing site. Measured runtimes and memory usage can later be queried with <a href="https://www.rdocumentation.org/packages/batchtools/topics/getJobTable"><code>getJobTable()</code></a> and used to better estimate the required resources for the remaining jobs. In this example we will set the number of CPUs per job to <code>1</code>, the walltime (time limit before jobs are stopped by the scheduler) to one hour (<code>3600</code> seconds), and the RAM limit (memory limit before jobs are stopped by the scheduler) to <code>8000</code> megabytes.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-19_2a8228476f07269a426462d5a43a6db3">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">resources</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>ncpus <span class="op">=</span> <span class="fl">1</span>, walltime <span class="op">=</span> <span class="fl">3600</span>, memory <span class="op">=</span> <span class="fl">8000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With all the elements in place, we can now submit our jobs.</p>
<!-- output to false otherwise we see the interactive cluster function -->
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/submitJobs.html">submitJobs</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="va">chunks</span>, resources <span class="op">=</span> <span class="va">resources</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># wait for all jobs to terminate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/waitForJobs.html">waitForJobs</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Submitting Jobs
</div>
</div>
<div class="callout-body-container callout-body">
<p>A good approach to submit computational jobs is by using a persistent R session (e.g., with Terminal Multiplexer (TMUX)) on the head node to continue job submission (or computation, depending on the cluster functions) in the background.</p>
<p>However, <code>batchtools</code> registries are saved to the file system and therefore persistent when the R session is terminated. This means that you can also submit jobs from an interactive R session, terminate the session, and analyze the results later in a new session.</p>
</div>
</div>
</section><section id="sec-batchtools-monitoring" class="level3 page-columns page-full" data-number="11.2.3"><h3 data-number="11.2.3" class="anchored" data-anchor-id="sec-batchtools-monitoring">
<span class="header-section-number">11.2.3</span> Job Monitoring, Error Handling, and Result Collection</h3>
<div class="page-columns page-full"><p>Once jobs have been submitted, they can then be queried with <a href="https://www.rdocumentation.org/packages/batchtools/topics/getStatus"><code>getStatus()</code></a> to find their current status and the results (or errors) can be investigated. If you terminated your R sessions after job submission, you can load the experiment registry with <a href="https://www.rdocumentation.org/packages/batchtools/topics/loadRegistry"><code>loadRegistry()</code></a>.</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://rdrr.io/pkg/batchtools/man/getStatus.html">getStatus()</a></code></span><span class=""><code><a href="https://rdrr.io/pkg/batchtools/man/loadRegistry.html">loadRegistry()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-041_b58d9fcf71c14170af61f7dcdb74d723">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/getStatus.html">getStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status for 180 jobs at 2023-07-12 08:50:53:
  Submitted    : 180 (100.0%)
  -- Queued    :   0 (  0.0%)
  -- Started   : 180 (100.0%)
  ---- Running :   0 (  0.0%)
  ---- Done    : 180 (100.0%)
  ---- Error   :   0 (  0.0%)
  ---- Expired :   0 (  0.0%)</code></pre>
</div>
</div>
<p>To query the ids of jobs in the respective categories, see <a href="https://www.rdocumentation.org/packages/batchtools/topics/findJobs"><code>findJobs()</code></a> and, e.g., <a href="https://www.rdocumentation.org/packages/batchtools/topics/findJobs"><code>findNotSubmitted()</code></a> or <a href="https://www.rdocumentation.org/packages/batchtools/topics/findJobs"><code>findDone()</code></a>. In our case, we can see all experiments finished and none expired (i.e., were removed from the queue without ever starting, <code>Expired : 0</code>) or crashed (<code>Error : 0</code>). It can still be sensible to use <a href="https://www.rdocumentation.org/packages/batchtools/topics/grepLogs"><code>grepLogs()</code></a> to check the logs for suspicious messages and warnings before proceeding with the analysis of the results.</p>
<p>In any large-scale experiment many things can and will go wrong, for example, the cluster might have an outage, jobs may run into resource limits or crash, or there could be bugs in your code. In these situations, it is important to quickly determine what went wrong and to recompute only the minimal number of required jobs.</p>
<p>To see debugging in practice we will use the debug learner (see <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-error-handling"><span>Section&nbsp;10.2</span></a>) with a 50% probability of erroring in training. When calling <a href="https://mlr3batchmark.mlr-org.com/reference/batchmark.html"><code>batchmark()</code></a> again, the new experiments will be added to the registry on top of the existing jobs.</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extra_design</span> <span class="op">=</span> <span class="fu">benchmark_grid</span><span class="op">(</span><span class="va">tasks</span>,</span>
<span>  <span class="fu">lrn</span><span class="op">(</span><span class="st">"classif.debug"</span>, error_train <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="va">resamplings</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https:///mlr3batchmark.mlr-org.com/reference/batchmark.html">batchmark</a></span><span class="op">(</span><span class="va">extra_design</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Registry Argument
</div>
</div>
<div class="callout-body-container callout-body">
<p>All <code>batchtools</code> functions that interoperate with a registry take a registry as an argument. By default, this argument is set to the last created registry, which is currently the <code>reg</code> object defined earlier. We pass it explicitly in this section for clarity.</p>
</div>
</div>
<p>Now we can get the IDs of the new jobs (which have not been submitted yet) and submit them by passing their IDs.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/findJobs.html">findNotSubmitted</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/submitJobs.html">submitJobs</a></span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After these jobs have terminated, we can get a summary of those that failed:</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-23_12abddf4129c46ec1081ab529cf331cf">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/getStatus.html">getStatus</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Status for 240 jobs at 2023-07-12 08:50:56:
  Submitted    : 240 (100.0%)
  -- Queued    :   0 (  0.0%)
  -- Started   : 240 (100.0%)
  ---- Running :   0 (  0.0%)
  ---- Done    : 213 ( 88.8%)
  ---- Error   :  27 ( 11.2%)
  ---- Expired :   0 (  0.0%)</code></pre>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">error_ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/findJobs.html">findErrors</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/summarizeExperiments.html">summarizeExperiments</a></span><span class="op">(</span><span class="va">error_ids</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"task_id"</span>, <span class="st">"learner_id"</span><span class="op">)</span>,</span>
<span>  reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           task_id    learner_id .count
1:        kr-vs-kp classif.debug      6
2:        breast-w classif.debug      3
3: credit-approval classif.debug      5
4:        credit-g classif.debug      6
5:        diabetes classif.debug      5
6:        spambase classif.debug      2</code></pre>
</div>
</div>
<p>In a real experiment, we would now investigate the debug learner further to understand why it errored, try to fix those bugs, and then potentially rerun those experiments only.</p>
<p>Assuming learners have been debugged (or we are happy to ignore them), we can then collect the results of our experiment with <a href="https://mlr3batchmark.mlr-org.com/reference/reduceResultsBatchmark.html"><code>reduceResultsBatchmark()</code></a>, which constructs a <a href="https://mlr3.mlr-org.com/reference/BenchmarkResult.html"><code>BenchmarkResult</code></a> from the results. Below we filter out results from the debug learner.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/unnamed-chunk-24_9069e9476b68805bb5f56f6fac73c776">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ids</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/findJobs.html">findExperiments</a></span><span class="op">(</span>algo.pars <span class="op">=</span> <span class="va">learner_id</span> <span class="op">!=</span> <span class="st">"classif.debug"</span>,</span>
<span>  reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">bmr</span> <span class="op">=</span> <span class="fu"><a href="https:///mlr3batchmark.mlr-org.com/reference/reduceResultsBatchmark.html">reduceResultsBatchmark</a></span><span class="op">(</span><span class="va">ids</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">bmr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nr  task_id  learner_id resampling_id iters classif.ce
1:  1 kr-vs-kp      logreg        custom    10    0.02566
2:  2 kr-vs-kp      ranger        custom    10    0.01377
3:  3 kr-vs-kp featureless        custom    10    0.47778
4:  4 breast-w      logreg        custom    10    0.03578
5:  5 breast-w      ranger        custom    10    0.02863
Hidden columns: resample_result</code></pre>
</div>
</div>
</section><section id="sec-custom-experiments" class="level3" data-number="11.2.4"><h3 data-number="11.2.4" class="anchored" data-anchor-id="sec-custom-experiments">
<span class="header-section-number">11.2.4</span> Custom Experiments with batchtools</h3>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This section covers advanced ML or technical details.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>In general, we recommend using <code>mlr3batchmark</code> for scheduling simpler <code>mlr3</code> jobs on an HPC, however, we will also briefly show you how to use <code>batchtools</code> without <code>mlr3batchmark</code> for finer control over your experiment. Again we start by creating an experiment registry.</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/makeExperimentRegistry.html">makeExperimentRegistry</a></span><span class="op">(</span></span>
<span>  file.dir <span class="op">=</span> <span class="st">"./experiments-custom"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  packages <span class="op">=</span> <span class="st">"mlr3verse"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>“Problems” are then manually registered with <a href="https://www.rdocumentation.org/packages/batchtools/topics/addProblem"><code>addProblem()</code></a>. In this example, we will register all task-resampling combinations of the <code>large_design</code> above using the task ids as unique names. We specify that the <code>data</code> for the problem (i.e., the static data that is trained/tested by the learner) is the task/resampling pair. Finally, we pass a function (<code>fun</code>, dynamic problem part) that takes in the static problem <code>data</code> and returns it as the problem <code>instance</code> without making changes (<a href="#fig-batchtools-illustration">Figure&nbsp;<span>11.2</span></a>). The <code>fun</code> shown below is the default behavior and could be omitted, we show it here for clarity. This function could be more complex and take further parameters to modify the problem instance dynamically.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">tasks</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/addProblem.html">addProblem</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">tasks</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>task <span class="op">=</span> <span class="va">tasks</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, resampling <span class="op">=</span> <span class="va">resamplings</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">job</span>, <span class="va">...</span><span class="op">)</span> <span class="va">data</span>,</span>
<span>    reg <span class="op">=</span> <span class="va">reg</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/fig-batchtools-illustration_0205a57aa02b7cb81c286ae83029e7ee">
<div class="cell-output-display">
<div id="fig-batchtools-illustration" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Figures/mlr3book_figures-31.svg" class="img-fluid figure-img" style="width:100.0%" alt="The diagram shows a rectangle that says 'static problem part, data', with an arrow pointing to 'dynamic problem function, fun(data, ...)' and 'algorithm function, fun(data, instance, ...)'. A box that says 'problem design, (addExperiments)' also has an arrow to the 'dynamic...' box. The 'dynamic...' box then has an arrow with text 'instance' that points to the 'algorithm function' box. A box that says 'algorithm design, (addExperiments)' also points to the 'algorithm function' box. Finally the 'algorithm function' box points to 'result'."></p>
<figcaption class="figure-caption">Figure&nbsp;11.2: Illustration of a batchtools problem, algorithm, and experiment.</figcaption></figure>
</div>
</div>
</div>
<p>Next, we need to specify the algorithm to run with <a href="https://www.rdocumentation.org/packages/batchtools/topics/addAlgorithm"><code>addAlgorithm()</code></a>. Algorithms are again specified with a unique <code>name</code>, as well as a function to define the computational steps of the experiment and to return its result.</p>
<p>Here, we define one job to represent a complete resample experiment. In general, algorithms in <code>batchtools</code> may return arbitrary objects – those are simply stored on the file system and can be processed with a custom function while collecting the results.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/addAlgorithm.html">addAlgorithm</a></span><span class="op">(</span></span>
<span>  <span class="st">"run_learner"</span>,</span>
<span>  fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">instance</span>, <span class="va">learner</span>, <span class="va">job</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">resample</span><span class="op">(</span><span class="va">instance</span><span class="op">$</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">instance</span><span class="op">$</span><span class="va">resampling</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  reg <span class="op">=</span> <span class="va">reg</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we will define concrete experiments with <a href="https://www.rdocumentation.org/packages/batchtools/topics/addExperiments"><code>addExperiments()</code></a> by passing problem designs (<code>prob.designs</code>) and algorithm designs (<code>algo.designs</code>) that assign parameters to problems and algorithms, respectively (<a href="#fig-batchtools-illustration">Figure&nbsp;<span>11.2</span></a>).</p>
<p>In the code below, we add all resampling iterations for the six tasks as experiments. By leaving <code>prob.designs</code> unspecified, experiments for all existing problems are created per default. We set the <code>learner</code> parameter of our algorithm (<code>"run_learner"</code>) to be the three learners from our <code>large_design</code> object. Note that whenever an experiment is added, the current seed is assigned to the experiment and then incremented.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-049_0ca82ad6dc854dbf8fe4f4b6240c9e62">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">alg_des</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>run_learner <span class="op">=</span> <span class="fu">data.table</span><span class="op">(</span>learner <span class="op">=</span> <span class="va">learners</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/addExperiments.html">addExperiments</a></span><span class="op">(</span>algo.designs <span class="op">=</span> <span class="va">alg_des</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/summarizeExperiments.html">summarizeExperiments</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our jobs can now be submitted to the cluster; by not specifying specific job IDs, <em>all</em> experiments are submitted.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/submitJobs.html">submitJobs</a></span><span class="op">(</span>reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can retrieve the job results using <a href="https://www.rdocumentation.org/packages/batchtools/topics/loadResult"><code>loadResult()</code></a>, which outputs the objects returned by the algorithm function, which in our case is a <a href="https://mlr3.mlr-org.com/reference/ResampleResult.html"><code>ResampleResult</code></a>. To retrieve all results at once, we can use <a href="https://www.rdocumentation.org/packages/batchtools/topics/reduceResults"><code>reduceResults()</code></a> to create a single <a href="https://mlr3.mlr-org.com/reference/BenchmarkResult.html"><code>BenchmarkResult</code></a>. For this, we use the combine function <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> which can combine multiple objects of type <code>ResampleResult</code> or <code>BenchmarkResult</code> to a single <code>BenchmarkResult</code>.</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-054_3619f49c403dc586ba77e86d851de11d">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/loadResult.html">loadResult</a></span><span class="op">(</span><span class="fl">1</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="fu">as.data.table</span><span class="op">(</span><span class="va">rr</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                task            learner             resampling
1: &lt;TaskClassif[51]&gt; &lt;GraphLearner[38]&gt; &lt;ResamplingCustom[20]&gt;
2: &lt;TaskClassif[51]&gt; &lt;GraphLearner[38]&gt; &lt;ResamplingCustom[20]&gt;
3: &lt;TaskClassif[51]&gt; &lt;GraphLearner[38]&gt; &lt;ResamplingCustom[20]&gt;
4: &lt;TaskClassif[51]&gt; &lt;GraphLearner[38]&gt; &lt;ResamplingCustom[20]&gt;
5: &lt;TaskClassif[51]&gt; &lt;GraphLearner[38]&gt; &lt;ResamplingCustom[20]&gt;
2 variables not shown: [iteration, prediction]</code></pre>
</div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bmr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/batchtools/man/reduceResults.html">reduceResults</a></span><span class="op">(</span><span class="va">c</span>, reg <span class="op">=</span> <span class="va">reg</span><span class="op">)</span></span>
<span><span class="va">bmr</span><span class="op">$</span><span class="fu">aggregate</span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   nr  task_id  learner_id resampling_id iters classif.ce
1:  1 kr-vs-kp      logreg        custom    10    0.02566
2:  2 kr-vs-kp      ranger        custom    10    0.01283
3:  3 kr-vs-kp featureless        custom    10    0.47778
4:  4 breast-w      logreg        custom    10    0.03578
5:  5 breast-w      ranger        custom    10    0.02861
Hidden columns: resample_result</code></pre>
</div>
</div>
</section></section><section id="sec-benchmark-analysis" class="level2 page-columns page-full" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="sec-benchmark-analysis">
<span class="header-section-number">11.3</span> Statistical Analysis</h2>
<p>The final step of a benchmarking experiment is to use statistical tests to determine which (if any) of our learners performed the best. <a href="https://mlr3benchmark.mlr-org.com/reference/mlr3benchmark-package.html"><code>mlr3benchmark</code></a> provides infrastructure for applying statistical significance tests on <a href="https://mlr3.mlr-org.com/reference/BenchmarkResult.html"><code>BenchmarkResult</code></a> objects.</p>
<div class="page-columns page-full"><p>Currently, Friedman tests and pairwise Friedman-Nemenyi tests <span class="citation" data-cites="demsar2006">(<a href="../references.html#ref-demsar2006" role="doc-biblioref">Demšar 2006</a>)</span> are supported to analyze benchmark experiments with at least two independent tasks and at least two learners. As a first step, we recommend performing a pairwise comparison of learners using pairwise Friedman-Nemenyi tests with <code>$friedman_posthoc()</code>. This method first performs a global comparison to see if any learner is statistically better than another. To use these methods we first convert the benchmark result to a <a href="https://mlr3benchmark.mlr-org.com/reference/BenchmarkAggr.html"><code>BenchmarkAggr</code></a> object using <a href="https://mlr3benchmark.mlr-org.com/reference/as_benchmark_aggr.html"><code>as_benchmark_aggr()</code></a>.</p><div class="no-row-height column-margin column-container"><span class=""><code><a href="https://mlr3benchmark.mlr-org.com/reference/as_benchmark_aggr.html">as_benchmark_aggr()</a></code></span></div></div>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/large_benchmarking-056_d9cafd6b0d3908b1f31f3fc217ac04eb">
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3benchmark.mlr-org.com">mlr3benchmark</a></span><span class="op">)</span></span>
<span><span class="va">bma</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3benchmark.mlr-org.com/reference/as_benchmark_aggr.html">as_benchmark_aggr</a></span><span class="op">(</span><span class="va">bmr</span>, measures <span class="op">=</span> <span class="fu">msr</span><span class="op">(</span><span class="st">"classif.ce"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bma</span><span class="op">$</span><span class="fu">friedman_posthoc</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
    Pairwise comparisons using Nemenyi-Wilcoxon-Wilcox all-pairs test for a two-way balanced complete block design</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>data: ce and learner_id and task_id</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            logreg ranger
ranger      0.4804 -     
featureless 0.1072 0.0043</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
P value adjustment method: single-step</code></pre>
</div>
</div>
<p>These results indicate a statistically significant difference between the <code>"featureless"</code> learner and <code>"ranger"</code> (assuming <span class="math inline">\(p\leq0.05\)</span> is significant). This table can be visualized in a critical difference plot (<a href="#fig-lsb-cd">Figure&nbsp;<span>11.3</span></a>), which typically shows the mean rank of a learning algorithm on the x-axis along with a thick horizontal line that connects learners that are pairwise not significantly different (while correcting for multiple tests).</p>
<div class="cell" data-hash="large-scale_benchmarking_cache/html/fig-lsb-cd_bdb817c73960298412b0bed212c6161d">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">autoplot</span><span class="op">(</span><span class="va">bma</span>, type <span class="op">=</span> <span class="st">"cd"</span>, ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lsb-cd" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="large-scale_benchmarking_files/figure-html/fig-lsb-cd-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Figure shows a one-axis diagram ranging from 0 to 4, above the diagram is a thick black line with text 'Critical Difference = 1.35'. Diagram shows 'ranger' on the far left just to the right of '1', then 'logreg' just to the left of '2', then 'featureless' just under '3'. There is a thick, black line connecting 'ranger' and 'logreg', as well as a thick, black line connecting 'logreg' and 'featureless'."></p>
<figcaption class="figure-caption">Figure&nbsp;11.3: Critical difference diagram comparing the random forest, logistic regression, and featureless baseline. The critical difference of 1.35 in the title refers to the difference in mean rank required to conclude that one learner performs statistically different to another.</figcaption></figure>
</div>
</div>
</div>
<p>Using <a href="#fig-lsb-cd">Figure&nbsp;<span>11.3</span></a> we can conclude that on average the random forest had the lowest (i.e., best) rank, followed by the logistic regression, and then the featureless baseline. While the random forest was statistically better performing than the baseline (no connecting line in <a href="#fig-lsb-cd">Figure&nbsp;<span>11.3</span></a>), it was not statistically superior to the logistic regression (connecting line in <a href="#fig-lsb-cd">Figure&nbsp;<span>11.3</span></a>). We could now further compare this with the large benchmark study conducted by <span class="citation" data-cites="couronne2018random">Couronné, Probst, and Boulesteix (<a href="../references.html#ref-couronne2018random" role="doc-biblioref">2018</a>)</span>, where the random forest outperformed the logistic regression in 69% of 243 real-world datasets.</p>
</section><section id="conclusion" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">11.4</span> Conclusion</h2>
<p>In this chapter, we have explored how to conduct large-scale machine learning experiments using <code>mlr3</code>. We have shown how to acquire diverse datasets from OpenML through the <a href="https://mlr3oml.mlr-org.com"><code>mlr3oml</code></a> interface package, how to execute large-scale experiments with <code>batchtools</code> and <a href="https://mlr3batchmark.mlr-org.com"><code>mlr3batchmark</code></a> integration, and finally how to analyze the results of these experiments with <a href="https://mlr3benchmark.mlr-org.com"><code>mlr3benchmark</code></a>. For further reading about <a href="https://cran.r-project.org/package=batchtools"><code>batchtools</code></a> we recommend <span class="citation" data-cites="batchtools">Lang, Bischl, and Surmann (<a href="../references.html#ref-batchtools" role="doc-biblioref">2017</a>)</span> and <span class="citation" data-cites="JSSv064i11">Bischl et al. (<a href="../references.html#ref-JSSv064i11" role="doc-biblioref">2015</a>)</span>.</p>
<div id="tbl-api-large-benchmarking" class="anchored">
<table class="table">
<caption>Table&nbsp;11.1: Important classes and functions covered in this chapter with underlying class (if applicable), class constructor or function, and important class fields and methods (if applicable).</caption>
<thead><tr class="header">
<th>Class</th>
<th>Constructor/Function</th>
<th>Fields/Methods</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_data.html"><code>OMLData</code></a></td>
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>odt()</code></a></td>
<td>
<code>$data</code>; <code>$feature_names</code>
</td>
</tr>
<tr class="even">
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_task.html"><code>OMLTask</code></a></td>
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>otsk()</code></a></td>
<td>
<code>$data</code>; <code>$task_splits</code>
</td>
</tr>
<tr class="odd">
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_collection.html"><code>OMLCollection</code></a></td>
<td><a href="https://mlr3oml.mlr-org.com/reference/oml_sugar.html"><code>ocl()</code></a></td>
<td><code>$task_ids</code></td>
</tr>
<tr class="even">
<td><code>Registry</code></td>
<td><a href="https://www.rdocumentation.org/packages/batchtools/topics/makeExperimentRegistry"><code>makeExperimentRegistry()</code></a></td>
<td>
<a href="https://www.rdocumentation.org/packages/batchtools/topics/submitJobs"><code>submitJobs()</code></a>; <a href="https://www.rdocumentation.org/packages/batchtools/topics/getStatus"><code>getStatus()</code></a>; <a href="https://mlr3batchmark.mlr-org.com/reference/reduceResultsBatchmark.html"><code>reduceResultsBatchmark</code></a>; <a href="https://www.rdocumentation.org/packages/batchtools/topics/getJobTable"><code>getJobTable</code></a>
</td>
</tr>
<tr class="odd">
<td></td>
<td><a href="https://mlr3batchmark.mlr-org.com/reference/batchmark.html"><code>batchmark()</code></a></td>
<td>-</td>
</tr>
<tr class="even">
<td><a href="https://mlr3benchmark.mlr-org.com/reference/BenchmarkAggr.html"><code>BenchmarkAggr()</code></a></td>
<td><a href="https://mlr3benchmark.mlr-org.com/reference/as_benchmark_aggr.html"><code>as_benchmark_aggr()</code></a></td>
<td><code>$friedman_posthoc()</code></td>
</tr>
</tbody>
</table>
</div>
</section><section id="exercises" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">11.5</span> Exercises</h2>
<p>In these exercises, we will conduct an empirical study analyzing whether a random forest is predictively stronger than a single decision tree. Our null hypothesis is that there is no significant performance difference.</p>
<ol type="1">
<li>Load the OpenML collection with ID 269, which contains regression tasks from the AutoML benchmark <span class="citation" data-cites="amlb2022">(<a href="../references.html#ref-amlb2022" role="doc-biblioref">Gijsbers et al. 2022</a>)</span>. Peek into this suite to study the contained data sets and their characteristics. Then find all tasks with less than 4000 observations and convert them to <code>mlr3</code> tasks.</li>
<li>Create an experimental design that compares <code>lrn("regr.ranger")</code> and <code>lrn("regr.rpart")</code> on those tasks. Use the robustify pipeline for both learners and a featureless fallback learner. You can use three-fold CV instead of the OpenML resamplings to save time. Run the comparison experiments with <code>batchtools</code>. Use default hyperparameter settings and do not perform any tuning to keep the experiments simple.</li>
<li>Conduct a global Friedman test and, if appropriate, post hoc Friedman-Nemenyi tests, and interpret the results. As an evaluation measure, use the MSE.</li>
</ol></section><section id="citation" class="level2" data-number="11.6"><h2 data-number="11.6" class="anchored" data-anchor-id="citation">
<span class="header-section-number">11.6</span> Citation</h2>
<p>Please cite this chapter as:</p>
<p>Fischer S, Lang M, Becker M. (2024). Large-Scale Benchmarking. In Bischl B, Sonabend R, Kotthoff L, Lang M, (Eds.), <em>Applied Machine Learning Using mlr3 in R</em>. CRC Press. https://mlr3book.mlr-org.com/large-scale_benchmarking.html.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-bischl2021openml" class="csl-entry" role="listitem">
Bischl, Bernd, Giuseppe Casalicchio, Matthias Feurer, Pieter Gijsbers, Frank Hutter, Michel Lang, Rafael Gomes Mantovani, Jan N. van Rijn, and Joaquin Vanschoren. 2021. <span>“Open<span>ML</span> Benchmarking Suites.”</span> In <em>Thirty-Fifth Conference on Neural Information Processing Systems Datasets and Benchmarks Track (Round 2)</em>. <a href="https://openreview.net/forum?id=OCrD8ycKjG">https://openreview.net/forum?id=OCrD8ycKjG</a>.
</div>
<div id="ref-JSSv064i11" class="csl-entry" role="listitem">
Bischl, Bernd, Michel Lang, Olaf Mersmann, Jörg Rahnenführer, and Claus Weihs. 2015. <span>“BatchJobs and BatchExperiments: Abstraction Mechanisms for Using r in Batch Environments.”</span> <em>Journal of Statistical Software</em> 64 (11): 1–25. <a href="https://doi.org/10.18637/jss.v064.i11">https://doi.org/10.18637/jss.v064.i11</a>.
</div>
<div id="ref-couronne2018random" class="csl-entry" role="listitem">
Couronné, Raphael, Philipp Probst, and Anne-Laure Boulesteix. 2018. <span>“Random Forest Versus Logistic Regression: A Large-Scale Benchmark Experiment.”</span> <em>BMC Bioinformatics</em> 19: 1–14. <a href="https://doi.org/10.1186/s12859-018-2264-5">https://doi.org/10.1186/s12859-018-2264-5</a>.
</div>
<div id="ref-demsar2006" class="csl-entry" role="listitem">
Demšar, Janez. 2006. <span>“Statistical Comparisons of Classifiers over Multiple Data Sets.”</span> <em>Journal of Machine Learning Research</em> 7 (1): 1–30. <a href="https://jmlr.org/papers/v7/demsar06a.html">https://jmlr.org/papers/v7/demsar06a.html</a>.
</div>
<div id="ref-amlb2022" class="csl-entry" role="listitem">
Gijsbers, Pieter, Marcos L. P. Bueno, Stefan Coors, Erin LeDell, Sébastien Poirier, Janek Thomas, Bernd Bischl, and Joaquin Vanschoren. 2022. <span>“AMLB: An AutoML Benchmark.”</span> arXiv. <a href="https://doi.org/10.48550/ARXIV.2207.12560">https://doi.org/10.48550/ARXIV.2207.12560</a>.
</div>
<div id="ref-grinsztajn2022why" class="csl-entry" role="listitem">
Grinsztajn, Leo, Edouard Oyallon, and Gael Varoquaux. 2022. <span>“Why Do Tree-Based Models Still Outperform Deep Learning on Typical Tabular Data?”</span> In <em>Thirty-Sixth Conference on Neural Information Processing Systems Datasets and Benchmarks Track</em>. <a href="https://openreview.net/forum?id=Fp7__phQszn">https://openreview.net/forum?id=Fp7__phQszn</a>.
</div>
<div id="ref-batchtools" class="csl-entry" role="listitem">
Lang, Michel, Bernd Bischl, and Dirk Surmann. 2017. <span>“<span class="nocase">batchtools</span>: Tools for <span>R</span> to Work on Batch Systems.”</span> <em>The Journal of Open Source Software</em> 2 (10). <a href="https://doi.org/10.21105/joss.00135">https://doi.org/10.21105/joss.00135</a>.
</div>
<div id="ref-openml2013" class="csl-entry" role="listitem">
Vanschoren, Joaquin, Jan N. van Rijn, Bernd Bischl, and Luis Torgo. 2013. <span>“OpenML: Networked Science in Machine Learning.”</span> <em>SIGKDD Explorations</em> 15 (2): 49–60. <a href="https://doi.org/10.1145/2641190.2641198">https://doi.org/10.1145/2641190.2641198</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Technical Aspects of mlr3</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/chapter12/model_interpretation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Interpretation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb82" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Large-Scale Benchmarking {#sec-large-benchmarking}</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_setup.qmd &gt;}}</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="in">`r chapter = "Large-Scale Benchmarking"`</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="in">`r authors(chapter)`</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-001}</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">"mlr3oml"</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">"off"</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3batchmark)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(batchtools)</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3oml)</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>))) {</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mlr3oml.cache =</span> <span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"cache"</span>))</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>In machine learning, it is often difficult to evaluate methods using mathematical analysis alone.</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>Even when formal analyses can be successfully applied, it is often an open question whether real-world datasets satisfy the necessary assumptions for the theorems to hold.</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>Empirical <span class="in">`r index('benchmark experiments')`</span> evaluate the performance of different algorithms on a wide range of datasets.</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>These empirical investigations are essential for understanding the capabilities and limitations of existing methods and for developing new and improved approaches.</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>Trustworthy benchmark experiments are often 'large-scale', which means they may make use of many datasets, measures, and learners.</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>Moreover, datasets must span a wide range of domains and problem types as conclusions can only be drawn about the kind of datasets on which the <span class="in">`r index('benchmark study', see = "benchmark experiment")`</span> was conducted.</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>Large-scale benchmark experiments consist of three primary steps: sourcing the data for the experiment, executing the experiment, and analyzing the results; we will discuss each of these in turn.</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>In @sec-openml we will begin by discussing <span class="in">`r ref_pkg("mlr3oml")`</span>, which provides an interface between <span class="in">`r mlr3`</span> and OpenML <span class="co">[</span><span class="ot">@openml2013</span><span class="co">]</span>, a popular tool for uploading and downloading datasets.</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>Increasing the number of datasets leads to 'large-scale' experiments that may require significant computational resources, so in @sec-hpc-exec we will introduce <span class="in">`r ref_pkg("mlr3batchmark")`</span>, which connects <span class="in">`mlr3`</span> with <span class="in">`r ref_pkg("batchtools")`</span> <span class="co">[</span><span class="ot">@batchtools</span><span class="co">]</span>, which provides methods for managing and executing experiments on <span class="in">`r index('high-performance computing')`</span> (HPC) clusters.</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>Finally, in @sec-benchmark-analysis we will demonstrate how to make use of <span class="in">`r ref_pkg("mlr3benchmark")`</span> to formally analyze the results from large-scale benchmark experiments.</span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>Throughout this chapter, we will use the running example of benchmarking a random forest model against a logistic regression as in @couronne2018random.</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>We will also assume that you have read @sec-pipelines and @sec-technical.</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a>We make use of <span class="in">`ppl("robustify")`</span> (@sec-prepro-robustify) for automating common preprocessing steps.</span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a>We also set a featureless baseline as a fallback learner (@sec-fallback) and set <span class="in">`"try"`</span> as our encapsulation method (@sec-encapsulation), which logs errors/warnings to an external file that can be read by <span class="in">`batchtools`</span> (we will return to this in @sec-batchtools-monitoring).</span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-002, warning = FALSE}</span></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a><span class="co"># featureless baseline</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>lrn_baseline <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>, <span class="at">id =</span> <span class="st">"featureless"</span>)</span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic regression pipeline</span></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>lrn_lr <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.log_reg"</span>)</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>lrn_lr <span class="ot">=</span> <span class="fu">as_learner</span>(<span class="fu">ppl</span>(<span class="st">"robustify"</span>, <span class="at">learner =</span> lrn_lr) <span class="sc">%&gt;&gt;%</span> lrn_lr)</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>lrn_lr<span class="sc">$</span>id <span class="ot">=</span> <span class="st">"logreg"</span></span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>lrn_lr<span class="sc">$</span>fallback <span class="ot">=</span> lrn_baseline</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>lrn_lr<span class="sc">$</span>encapsulate <span class="ot">=</span> <span class="fu">c</span>(<span class="at">train =</span> <span class="st">"try"</span>, <span class="at">predict =</span> <span class="st">"try"</span>)</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a><span class="co"># random forest pipeline</span></span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a>lrn_rf <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>lrn_rf <span class="ot">=</span> <span class="fu">as_learner</span>(<span class="fu">ppl</span>(<span class="st">"robustify"</span>, <span class="at">learner =</span> lrn_rf) <span class="sc">%&gt;&gt;%</span> lrn_rf)</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>lrn_rf<span class="sc">$</span>id <span class="ot">=</span> <span class="st">"ranger"</span></span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>lrn_rf<span class="sc">$</span>fallback <span class="ot">=</span> lrn_baseline</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a>lrn_rf<span class="sc">$</span>encapsulate <span class="ot">=</span> <span class="fu">c</span>(<span class="at">train =</span> <span class="st">"try"</span>, <span class="at">predict =</span> <span class="st">"try"</span>)</span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a>learners <span class="ot">=</span> <span class="fu">list</span>(lrn_lr, lrn_rf, lrn_baseline)</span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a>As a starting example, we will compare our learners across three classification tasks using accuracy and three-fold CV.</span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-63"><a href="#cb82-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-64"><a href="#cb82-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb82-65"><a href="#cb82-65" aria-hidden="true" tabindex="-1"></a>design <span class="ot">=</span> <span class="fu">benchmark_grid</span>(<span class="fu">tsks</span>(<span class="fu">c</span>(<span class="st">"german_credit"</span>, <span class="st">"sonar"</span>, <span class="st">"pima"</span>)),</span>
<span id="cb82-66"><a href="#cb82-66" aria-hidden="true" tabindex="-1"></a>  learners, <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">10</span>))</span>
<span id="cb82-67"><a href="#cb82-67" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">=</span> <span class="fu">benchmark</span>(design)</span>
<span id="cb82-68"><a href="#cb82-68" aria-hidden="true" tabindex="-1"></a>bmr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))[, .(task_id, learner_id, classif.acc)]</span>
<span id="cb82-69"><a href="#cb82-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-70"><a href="#cb82-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-71"><a href="#cb82-71" aria-hidden="true" tabindex="-1"></a>In this small experiment, random forests appears to outperform the other learners on all three datasets.</span>
<span id="cb82-72"><a href="#cb82-72" aria-hidden="true" tabindex="-1"></a>However, this analysis is not conclusive as we only considered three tasks, and the performance differences might not be statistically significant.</span>
<span id="cb82-73"><a href="#cb82-73" aria-hidden="true" tabindex="-1"></a>In the following, we will introduce some techniques to improve the study.</span>
<span id="cb82-74"><a href="#cb82-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-75"><a href="#cb82-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting Data with OpenML {#sec-openml}</span></span>
<span id="cb82-76"><a href="#cb82-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-77"><a href="#cb82-77" aria-hidden="true" tabindex="-1"></a>To draw meaningful conclusions from benchmark experiments, a good choice of datasets and tasks is essential.</span>
<span id="cb82-78"><a href="#cb82-78" aria-hidden="true" tabindex="-1"></a><span class="in">`r index('OpenML', aside = TRUE, lower = FALSE)`</span> is an open-source platform that facilitates the sharing and dissemination of machine learning research data, algorithms, and experimental results, in a standardized format enabling consistent cross-study comparison.</span>
<span id="cb82-79"><a href="#cb82-79" aria-hidden="true" tabindex="-1"></a>OpenML's design ensures that all data on the platform is '<span class="in">`r index('FAIR', lower = FALSE)`</span>' (**F**indability, **A**ccessibility, **I**nteroperability and **R**eusability), which ensures the data is easily discoverable and reusable.</span>
<span id="cb82-80"><a href="#cb82-80" aria-hidden="true" tabindex="-1"></a>All entities on the platform have unique identifiers and standardized (meta)data that can be accessed via a REST API or the web interface.</span>
<span id="cb82-81"><a href="#cb82-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-82"><a href="#cb82-82" aria-hidden="true" tabindex="-1"></a>In this section, we will cover some of the main features of OpenML and how to use them via the  <span class="in">`r mlr3oml`</span> interface package.</span>
<span id="cb82-83"><a href="#cb82-83" aria-hidden="true" tabindex="-1"></a>In particular, we will discuss OpenML datasets, tasks, and task collections, but will not cover algorithms or experiment results here.</span>
<span id="cb82-84"><a href="#cb82-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-85"><a href="#cb82-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### Datasets {#sec-openml-dataset}</span></span>
<span id="cb82-86"><a href="#cb82-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-87"><a href="#cb82-87" aria-hidden="true" tabindex="-1"></a>Finding data from OpenML is possible via the website or its REST API that <span class="in">`mlr3oml`</span> interfaces.</span>
<span id="cb82-88"><a href="#cb82-88" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("list_oml_data()")`</span> can be used to filter datasets for specific properties, for example by number of features, rows, or number of classes in a classification problem:</span>
<span id="cb82-89"><a href="#cb82-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-92"><a href="#cb82-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-93"><a href="#cb82-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-94"><a href="#cb82-94" aria-hidden="true" tabindex="-1"></a>path_odatasets <span class="ot">=</span> <span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>, <span class="st">"odatasets_filter.rds"</span>)</span>
<span id="cb82-95"><a href="#cb82-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-96"><a href="#cb82-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-97"><a href="#cb82-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-014, eval = !file.exists(path_odatasets)}</span></span>
<span id="cb82-98"><a href="#cb82-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3oml)</span>
<span id="cb82-99"><a href="#cb82-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-100"><a href="#cb82-100" aria-hidden="true" tabindex="-1"></a>odatasets <span class="ot">=</span> <span class="fu">list_oml_data</span>(</span>
<span id="cb82-101"><a href="#cb82-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_features =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>),</span>
<span id="cb82-102"><a href="#cb82-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_instances =</span> <span class="fu">c</span>(<span class="dv">45000</span>, <span class="dv">50000</span>),</span>
<span id="cb82-103"><a href="#cb82-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_classes =</span> <span class="dv">2</span></span>
<span id="cb82-104"><a href="#cb82-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-105"><a href="#cb82-105" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-106"><a href="#cb82-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-109"><a href="#cb82-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-110"><a href="#cb82-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-111"><a href="#cb82-111" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(path_odatasets)) {</span>
<span id="cb82-112"><a href="#cb82-112" aria-hidden="true" tabindex="-1"></a>  odatasets <span class="ot">=</span> <span class="fu">readRDS</span>(path_odatasets)</span>
<span id="cb82-113"><a href="#cb82-113" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-114"><a href="#cb82-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(odatasets, path_odatasets)</span>
<span id="cb82-115"><a href="#cb82-115" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-116"><a href="#cb82-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-117"><a href="#cb82-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-118"><a href="#cb82-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-121"><a href="#cb82-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-122"><a href="#cb82-122" aria-hidden="true" tabindex="-1"></a>odatasets[NumberOfFeatures <span class="sc">&lt;</span> <span class="dv">16</span>,</span>
<span id="cb82-123"><a href="#cb82-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"data_id"</span>, <span class="st">"name"</span>, <span class="st">"NumberOfFeatures"</span>, <span class="st">"NumberOfInstances"</span>)]</span>
<span id="cb82-124"><a href="#cb82-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-125"><a href="#cb82-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-126"><a href="#cb82-126" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`list_oml_data()`</span> returns a <span class="in">`data.table`</span> with many more meta-features than shown here; this table can itself be used to filter further.</span>
<span id="cb82-127"><a href="#cb82-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-128"><a href="#cb82-128" aria-hidden="true" tabindex="-1"></a>We can see that some datasets have duplicated names, which is why each dataset also has a unique ID.</span>
<span id="cb82-129"><a href="#cb82-129" aria-hidden="true" tabindex="-1"></a>By example, let us consider the 'adult' dataset with ID 1590.</span>
<span id="cb82-130"><a href="#cb82-130" aria-hidden="true" tabindex="-1"></a>Metadata for the dataset is loaded with <span class="in">`r ref("odt()", aside = TRUE)`</span>, which returns an object of class <span class="in">`r ref("OMLData")`</span>.</span>
<span id="cb82-131"><a href="#cb82-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-132"><a href="#cb82-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-003}</span></span>
<span id="cb82-133"><a href="#cb82-133" aria-hidden="true" tabindex="-1"></a>odata <span class="ot">=</span> <span class="fu">odt</span>(<span class="at">id =</span> <span class="dv">1590</span>)</span>
<span id="cb82-134"><a href="#cb82-134" aria-hidden="true" tabindex="-1"></a>odata</span>
<span id="cb82-135"><a href="#cb82-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-136"><a href="#cb82-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-137"><a href="#cb82-137" aria-hidden="true" tabindex="-1"></a>The <span class="in">`OMLData`</span> object contains metadata about the dataset but importantly does not (yet) contain the data.</span>
<span id="cb82-138"><a href="#cb82-138" aria-hidden="true" tabindex="-1"></a>This means that information about the dataset can be queried without having to load the entire data into memory, for example, the license and dimension of the data:</span>
<span id="cb82-139"><a href="#cb82-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-140"><a href="#cb82-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-004}</span></span>
<span id="cb82-141"><a href="#cb82-141" aria-hidden="true" tabindex="-1"></a>odata<span class="sc">$</span>license</span>
<span id="cb82-142"><a href="#cb82-142" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">nrow =</span> odata<span class="sc">$</span>nrow, <span class="at">ncol =</span> odata<span class="sc">$</span>ncol)</span>
<span id="cb82-143"><a href="#cb82-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-144"><a href="#cb82-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-145"><a href="#cb82-145" aria-hidden="true" tabindex="-1"></a>If we want to work with the actual data, then accessing the <span class="in">`$data`</span> field will download the data, import it into R, and then store the <span class="in">`data.frame`</span> in the <span class="in">`OMLData`</span> object:</span>
<span id="cb82-146"><a href="#cb82-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-147"><a href="#cb82-147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-005}</span></span>
<span id="cb82-148"><a href="#cb82-148" aria-hidden="true" tabindex="-1"></a><span class="co"># first 5 rows and columns</span></span>
<span id="cb82-149"><a href="#cb82-149" aria-hidden="true" tabindex="-1"></a>odata<span class="sc">$</span>data[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb82-150"><a href="#cb82-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-151"><a href="#cb82-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-152"><a href="#cb82-152" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb82-153"><a href="#cb82-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## mlr3oml Cache</span></span>
<span id="cb82-154"><a href="#cb82-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-155"><a href="#cb82-155" aria-hidden="true" tabindex="-1"></a>After <span class="in">`$data`</span> has been called the first time, all subsequent calls to <span class="in">`$data`</span> will be transparently redirected to the in-memory <span class="in">`data.frame`</span>.</span>
<span id="cb82-156"><a href="#cb82-156" aria-hidden="true" tabindex="-1"></a>Additionally, many objects can be permanently cached on the local file system by setting the option <span class="in">`mlr3oml.cache`</span> to either <span class="in">`TRUE`</span> or to a specific path to be used as the cache folder.</span>
<span id="cb82-157"><a href="#cb82-157" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-158"><a href="#cb82-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-159"><a href="#cb82-159" aria-hidden="true" tabindex="-1"></a>Data can then be converted into <span class="in">`mlr3`</span> backends (see @sec-backends) with the <span class="in">`r ref("as_data_backend()")`</span> function and then into tasks:</span>
<span id="cb82-160"><a href="#cb82-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-161"><a href="#cb82-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-006}</span></span>
<span id="cb82-162"><a href="#cb82-162" aria-hidden="true" tabindex="-1"></a>backend <span class="ot">=</span> <span class="fu">as_data_backend</span>(odata)</span>
<span id="cb82-163"><a href="#cb82-163" aria-hidden="true" tabindex="-1"></a>tsk_adult <span class="ot">=</span> <span class="fu">as_task_classif</span>(backend, <span class="at">target =</span> <span class="st">"class"</span>)</span>
<span id="cb82-164"><a href="#cb82-164" aria-hidden="true" tabindex="-1"></a>tsk_adult</span>
<span id="cb82-165"><a href="#cb82-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-166"><a href="#cb82-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-167"><a href="#cb82-167" aria-hidden="true" tabindex="-1"></a>Some datasets on OpenML contain columns that should neither be used as a feature nor a target.</span>
<span id="cb82-168"><a href="#cb82-168" aria-hidden="true" tabindex="-1"></a>The column names that are usually included as features are accessible through the field <span class="in">`$feature_names`</span>, and we assign them to the <span class="in">`mlr3`</span> task accordingly.</span>
<span id="cb82-169"><a href="#cb82-169" aria-hidden="true" tabindex="-1"></a>Note that for the dataset at hand, this would not have been necessary, as all non-target columns are to be treated as predictors, but we include it for clarity.</span>
<span id="cb82-170"><a href="#cb82-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-173"><a href="#cb82-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-174"><a href="#cb82-174" aria-hidden="true" tabindex="-1"></a>tsk_adult<span class="sc">$</span>col_roles<span class="sc">$</span>feature <span class="ot">=</span> odata<span class="sc">$</span>feature_names</span>
<span id="cb82-175"><a href="#cb82-175" aria-hidden="true" tabindex="-1"></a>tsk_adult</span>
<span id="cb82-176"><a href="#cb82-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-177"><a href="#cb82-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-178"><a href="#cb82-178" aria-hidden="true" tabindex="-1"></a><span class="fu">### Task {#sec-openml-task}</span></span>
<span id="cb82-179"><a href="#cb82-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-180"><a href="#cb82-180" aria-hidden="true" tabindex="-1"></a>OpenML tasks are built on top of OpenML datasets and additionally specify the target variable, the train-test splits to use for resampling, and more.</span>
<span id="cb82-181"><a href="#cb82-181" aria-hidden="true" tabindex="-1"></a>Note that this differs from <span class="in">`mlr3`</span> <span class="in">`Task`</span> objects, which do not contain information about the resampling procedure.</span>
<span id="cb82-182"><a href="#cb82-182" aria-hidden="true" tabindex="-1"></a>Similarly to <span class="in">`mlr3`</span>, OpenML has different types of tasks, such as regression and classification.</span>
<span id="cb82-183"><a href="#cb82-183" aria-hidden="true" tabindex="-1"></a>Analogously to filtering datasets, tasks can be filtered with <span class="in">`r ref("list_oml_tasks()")`</span>.</span>
<span id="cb82-184"><a href="#cb82-184" aria-hidden="true" tabindex="-1"></a>To find a task that makes use of the data we have been using, we would pass the data ID to the <span class="in">`data_id`</span> argument:</span>
<span id="cb82-185"><a href="#cb82-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-188"><a href="#cb82-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-189"><a href="#cb82-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-190"><a href="#cb82-190" aria-hidden="true" tabindex="-1"></a>path_adult_tasks <span class="ot">=</span> <span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>, <span class="st">"adult_tasks.rds"</span>)</span>
<span id="cb82-191"><a href="#cb82-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-192"><a href="#cb82-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-193"><a href="#cb82-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = !file.exists(path_adult_tasks)}</span></span>
<span id="cb82-194"><a href="#cb82-194" aria-hidden="true" tabindex="-1"></a><span class="co"># tasks making use of the adult data</span></span>
<span id="cb82-195"><a href="#cb82-195" aria-hidden="true" tabindex="-1"></a>adult_tasks <span class="ot">=</span> <span class="fu">list_oml_tasks</span>(<span class="at">data_id =</span> <span class="dv">1590</span>)</span>
<span id="cb82-196"><a href="#cb82-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-197"><a href="#cb82-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-200"><a href="#cb82-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-201"><a href="#cb82-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-202"><a href="#cb82-202" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(path_adult_tasks)) {</span>
<span id="cb82-203"><a href="#cb82-203" aria-hidden="true" tabindex="-1"></a>  adult_tasks <span class="ot">=</span> <span class="fu">readRDS</span>(path_adult_tasks)</span>
<span id="cb82-204"><a href="#cb82-204" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-205"><a href="#cb82-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(adult_tasks, path_adult_tasks)</span>
<span id="cb82-206"><a href="#cb82-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-207"><a href="#cb82-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-208"><a href="#cb82-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-211"><a href="#cb82-211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-212"><a href="#cb82-212" aria-hidden="true" tabindex="-1"></a>adult_tasks[task_type <span class="sc">==</span> <span class="st">"Supervised Classification"</span>, task_id]</span>
<span id="cb82-213"><a href="#cb82-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-214"><a href="#cb82-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-215"><a href="#cb82-215" aria-hidden="true" tabindex="-1"></a>From these tasks, we randomly select the task with ID 359983.</span>
<span id="cb82-216"><a href="#cb82-216" aria-hidden="true" tabindex="-1"></a>We can load the object using <span class="in">`r ref("otsk()", aside = TRUE)`</span>, which returns an <span class="in">`r ref("OMLTask")`</span> object.</span>
<span id="cb82-217"><a href="#cb82-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-218"><a href="#cb82-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-009}</span></span>
<span id="cb82-219"><a href="#cb82-219" aria-hidden="true" tabindex="-1"></a>otask <span class="ot">=</span> <span class="fu">otsk</span>(<span class="at">id =</span> <span class="dv">359983</span>)</span>
<span id="cb82-220"><a href="#cb82-220" aria-hidden="true" tabindex="-1"></a>otask</span>
<span id="cb82-221"><a href="#cb82-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-222"><a href="#cb82-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-223"><a href="#cb82-223" aria-hidden="true" tabindex="-1"></a>The <span class="in">`OMLData`</span> object associated with the underlying dataset can be accessed through the <span class="in">`$data`</span> field.</span>
<span id="cb82-224"><a href="#cb82-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-225"><a href="#cb82-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-010}</span></span>
<span id="cb82-226"><a href="#cb82-226" aria-hidden="true" tabindex="-1"></a>otask<span class="sc">$</span>data</span>
<span id="cb82-227"><a href="#cb82-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-228"><a href="#cb82-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-229"><a href="#cb82-229" aria-hidden="true" tabindex="-1"></a>The data splits associated with the estimation procedure are accessible through the field <span class="in">`$task_splits`</span>.</span>
<span id="cb82-230"><a href="#cb82-230" aria-hidden="true" tabindex="-1"></a>In <span class="in">`mlr3`</span> terms, these are the instantiation of a <span class="in">`r ref("mlr3::Resampling")`</span> on a specific <span class="in">`r ref("mlr3::Task")`</span>.</span>
<span id="cb82-231"><a href="#cb82-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-232"><a href="#cb82-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-011}</span></span>
<span id="cb82-233"><a href="#cb82-233" aria-hidden="true" tabindex="-1"></a>otask<span class="sc">$</span>task_splits</span>
<span id="cb82-234"><a href="#cb82-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-235"><a href="#cb82-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-236"><a href="#cb82-236" aria-hidden="true" tabindex="-1"></a>The OpenML task can be converted to both an <span class="in">`mlr3::Task`</span> and <span class="in">`r ref("mlr3::ResamplingCustom")`</span> instantiated on the task using <span class="in">`r ref("as_task()")`</span> and <span class="in">`r ref("as_resampling()")`</span>, respectively:</span>
<span id="cb82-237"><a href="#cb82-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-238"><a href="#cb82-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-012}</span></span>
<span id="cb82-239"><a href="#cb82-239" aria-hidden="true" tabindex="-1"></a>tsk_adult <span class="ot">=</span> <span class="fu">as_task</span>(otask)</span>
<span id="cb82-240"><a href="#cb82-240" aria-hidden="true" tabindex="-1"></a>tsk_adult</span>
<span id="cb82-241"><a href="#cb82-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-242"><a href="#cb82-242" aria-hidden="true" tabindex="-1"></a>resampling <span class="ot">=</span> <span class="fu">as_resampling</span>(otask)</span>
<span id="cb82-243"><a href="#cb82-243" aria-hidden="true" tabindex="-1"></a>resampling</span>
<span id="cb82-244"><a href="#cb82-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-245"><a href="#cb82-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-246"><a href="#cb82-246" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3oml`</span> also allows direct construction of <span class="in">`mlr3`</span> tasks and resamplings with the standard <span class="in">`r ref("tsk()")`</span> and <span class="in">`r ref("rsmp()")`</span> constructors, e.g.:</span>
<span id="cb82-247"><a href="#cb82-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-250"><a href="#cb82-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-251"><a href="#cb82-251" aria-hidden="true" tabindex="-1"></a><span class="fu">tsk</span>(<span class="st">"oml"</span>, <span class="at">task_id =</span> <span class="dv">359983</span>)</span>
<span id="cb82-252"><a href="#cb82-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-253"><a href="#cb82-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-254"><a href="#cb82-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-255"><a href="#cb82-255" aria-hidden="true" tabindex="-1"></a><span class="fu">### Task Collection {#sec-openml-collection}</span></span>
<span id="cb82-256"><a href="#cb82-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-257"><a href="#cb82-257" aria-hidden="true" tabindex="-1"></a>The OpenML task collection is a container object bundling existing tasks.</span>
<span id="cb82-258"><a href="#cb82-258" aria-hidden="true" tabindex="-1"></a>This allows for the creation of <span class="in">`r index("benchmark suites")`</span>, which are curated collections of tasks that satisfy certain quality criteria.</span>
<span id="cb82-259"><a href="#cb82-259" aria-hidden="true" tabindex="-1"></a>Examples include the OpenML CC-18 benchmark suite <span class="co">[</span><span class="ot">@bischl2021openml</span><span class="co">]</span>, the AutoML benchmark <span class="co">[</span><span class="ot">@amlb2022</span><span class="co">]</span> and the benchmark for tabular deep learning <span class="co">[</span><span class="ot">@grinsztajn2022why</span><span class="co">]</span>.</span>
<span id="cb82-260"><a href="#cb82-260" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("OMLCollection")`</span> objects are loaded with <span class="in">`r ref("ocl()", aside = TRUE)`</span>, by example we will look at CC-18, which has ID 99:</span>
<span id="cb82-261"><a href="#cb82-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-264"><a href="#cb82-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-265"><a href="#cb82-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-266"><a href="#cb82-266" aria-hidden="true" tabindex="-1"></a>path_otask_collection <span class="ot">=</span> <span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>,</span>
<span id="cb82-267"><a href="#cb82-267" aria-hidden="true" tabindex="-1"></a>  <span class="st">"otask_collection99.rds"</span>)</span>
<span id="cb82-268"><a href="#cb82-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-269"><a href="#cb82-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-270"><a href="#cb82-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-017, eval = !file.exists(path_otask_collection)}</span></span>
<span id="cb82-271"><a href="#cb82-271" aria-hidden="true" tabindex="-1"></a>otask_collection <span class="ot">=</span> <span class="fu">ocl</span>(<span class="at">id =</span> <span class="dv">99</span>)</span>
<span id="cb82-272"><a href="#cb82-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-273"><a href="#cb82-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-276"><a href="#cb82-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-277"><a href="#cb82-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-278"><a href="#cb82-278" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(path_otask_collection)) {</span>
<span id="cb82-279"><a href="#cb82-279" aria-hidden="true" tabindex="-1"></a>  otask_collection <span class="ot">=</span> <span class="fu">readRDS</span>(path_otask_collection)</span>
<span id="cb82-280"><a href="#cb82-280" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-281"><a href="#cb82-281" aria-hidden="true" tabindex="-1"></a>  <span class="co"># need to trigger the download</span></span>
<span id="cb82-282"><a href="#cb82-282" aria-hidden="true" tabindex="-1"></a>  otask_collection<span class="sc">$</span>task_ids</span>
<span id="cb82-283"><a href="#cb82-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(otask_collection, path_otask_collection)</span>
<span id="cb82-284"><a href="#cb82-284" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-285"><a href="#cb82-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-286"><a href="#cb82-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-287"><a href="#cb82-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-019}</span></span>
<span id="cb82-288"><a href="#cb82-288" aria-hidden="true" tabindex="-1"></a>otask_collection</span>
<span id="cb82-289"><a href="#cb82-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-290"><a href="#cb82-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-291"><a href="#cb82-291" aria-hidden="true" tabindex="-1"></a>The task includes 72 classification tasks on different datasets that can be accessed through <span class="in">`$task_ids`</span>:</span>
<span id="cb82-292"><a href="#cb82-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-293"><a href="#cb82-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-020}</span></span>
<span id="cb82-294"><a href="#cb82-294" aria-hidden="true" tabindex="-1"></a>otask_collection<span class="sc">$</span>task_ids[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="co"># first 5 tasks in the collection</span></span>
<span id="cb82-295"><a href="#cb82-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-296"><a href="#cb82-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-297"><a href="#cb82-297" aria-hidden="true" tabindex="-1"></a>Task collections can be used to quickly define benchmark experiments in <span class="in">`mlr3`</span>.</span>
<span id="cb82-298"><a href="#cb82-298" aria-hidden="true" tabindex="-1"></a>To easily construct all tasks and resamplings from the benchmarking suite, you can use <span class="in">`r ref("as_tasks()", index = TRUE)`</span> and <span class="in">`r ref("as_resamplings()", index = TRUE)`</span> respectively:</span>
<span id="cb82-299"><a href="#cb82-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-300"><a href="#cb82-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb82-301"><a href="#cb82-301" aria-hidden="true" tabindex="-1"></a>tasks <span class="ot">=</span> <span class="fu">as_tasks</span>(otask_collection)</span>
<span id="cb82-302"><a href="#cb82-302" aria-hidden="true" tabindex="-1"></a>resamplings <span class="ot">=</span> <span class="fu">as_resamplings</span>(otask_collection)</span>
<span id="cb82-303"><a href="#cb82-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-304"><a href="#cb82-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-305"><a href="#cb82-305" aria-hidden="true" tabindex="-1"></a>Alternatively, if we wanted to filter the collection further, say to a binary classification experiment with six tasks, we could run <span class="in">`r ref("list_oml_tasks()")`</span> with the task IDs from the CC-18 collection as argument <span class="in">`task_id`</span>.</span>
<span id="cb82-306"><a href="#cb82-306" aria-hidden="true" tabindex="-1"></a>We can either use the <span class="in">`list_oml_tasks()`</span> argument to request the number of classes to be <span class="in">`2`</span>, or we can make use of the fact that the result of <span class="in">`list_oml_tasks()`</span> is a <span class="in">`data.table`</span> and subset the resulting table.</span>
<span id="cb82-307"><a href="#cb82-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-310"><a href="#cb82-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-311"><a href="#cb82-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-312"><a href="#cb82-312" aria-hidden="true" tabindex="-1"></a>path_binary_cc18 <span class="ot">=</span> <span class="fu">file.path</span>(<span class="st">"openml"</span>, <span class="st">"manual"</span>, <span class="st">"binary_cc18.rds"</span>)</span>
<span id="cb82-313"><a href="#cb82-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-314"><a href="#cb82-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-315"><a href="#cb82-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-021, eval = !file.exists(path_binary_cc18)}</span></span>
<span id="cb82-316"><a href="#cb82-316" aria-hidden="true" tabindex="-1"></a>binary_cc18 <span class="ot">=</span> <span class="fu">list_oml_tasks</span>(</span>
<span id="cb82-317"><a href="#cb82-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">limit =</span> <span class="dv">6</span>,</span>
<span id="cb82-318"><a href="#cb82-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">task_id =</span> otask_collection<span class="sc">$</span>task_ids,</span>
<span id="cb82-319"><a href="#cb82-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_classes =</span> <span class="dv">2</span></span>
<span id="cb82-320"><a href="#cb82-320" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-321"><a href="#cb82-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-322"><a href="#cb82-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-325"><a href="#cb82-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-326"><a href="#cb82-326" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-327"><a href="#cb82-327" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(path_binary_cc18)) {</span>
<span id="cb82-328"><a href="#cb82-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(binary_cc18, path_binary_cc18)</span>
<span id="cb82-329"><a href="#cb82-329" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb82-330"><a href="#cb82-330" aria-hidden="true" tabindex="-1"></a>  binary_cc18 <span class="ot">=</span> <span class="fu">readRDS</span>(path_binary_cc18)</span>
<span id="cb82-331"><a href="#cb82-331" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-332"><a href="#cb82-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-333"><a href="#cb82-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-334"><a href="#cb82-334" aria-hidden="true" tabindex="-1"></a>We now define the tasks and resamplings which we will use for comparing the logistic regression with the random forest learner.</span>
<span id="cb82-335"><a href="#cb82-335" aria-hidden="true" tabindex="-1"></a>Note that all resamplings in this collection consist of exactly 10 iterations.</span>
<span id="cb82-336"><a href="#cb82-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-337"><a href="#cb82-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-024}</span></span>
<span id="cb82-338"><a href="#cb82-338" aria-hidden="true" tabindex="-1"></a><span class="co"># load tasks as a list</span></span>
<span id="cb82-339"><a href="#cb82-339" aria-hidden="true" tabindex="-1"></a>otasks <span class="ot">=</span> <span class="fu">lapply</span>(binary_cc18<span class="sc">$</span>task_id, otsk)</span>
<span id="cb82-340"><a href="#cb82-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-341"><a href="#cb82-341" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to mlr3 tasks and resamplings</span></span>
<span id="cb82-342"><a href="#cb82-342" aria-hidden="true" tabindex="-1"></a>tasks <span class="ot">=</span> <span class="fu">as_tasks</span>(otasks)</span>
<span id="cb82-343"><a href="#cb82-343" aria-hidden="true" tabindex="-1"></a>resamplings <span class="ot">=</span> <span class="fu">as_resamplings</span>(otasks)</span>
<span id="cb82-344"><a href="#cb82-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-345"><a href="#cb82-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-346"><a href="#cb82-346" aria-hidden="true" tabindex="-1"></a>To define the design table, we use <span class="in">`r ref("benchmark_grid()")`</span> and set <span class="in">`paired`</span> to <span class="in">`TRUE`</span>, which is used in situations where each resampling is instantiated on a corresponding task (therefore the <span class="in">`tasks`</span> and <span class="in">`resamplings`</span> below must have the same length) and each learner should be evaluated on every resampled task.</span>
<span id="cb82-347"><a href="#cb82-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-348"><a href="#cb82-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-025}</span></span>
<span id="cb82-349"><a href="#cb82-349" aria-hidden="true" tabindex="-1"></a>large_design <span class="ot">=</span> <span class="fu">benchmark_grid</span>(tasks, learners, resamplings,</span>
<span id="cb82-350"><a href="#cb82-350" aria-hidden="true" tabindex="-1"></a>  <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-351"><a href="#cb82-351" aria-hidden="true" tabindex="-1"></a>large_design[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>] <span class="co"># first 6 rows</span></span>
<span id="cb82-352"><a href="#cb82-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-353"><a href="#cb82-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-354"><a href="#cb82-354" aria-hidden="true" tabindex="-1"></a>Having set up our large experiment, we can now look at how to efficiently carry it out on a cluster.</span>
<span id="cb82-355"><a href="#cb82-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-356"><a href="#cb82-356" aria-hidden="true" tabindex="-1"></a><span class="fu">## Benchmarking on HPC Clusters {#sec-hpc-exec}</span></span>
<span id="cb82-357"><a href="#cb82-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-358"><a href="#cb82-358" aria-hidden="true" tabindex="-1"></a>As discussed in @sec-parallelization, parallelization of benchmark experiments is straightforward as they are <span class="in">`r index('embarrassingly parallel')`</span>.</span>
<span id="cb82-359"><a href="#cb82-359" aria-hidden="true" tabindex="-1"></a>However, for large experiments, parallelization on a <span class="in">`r index('high-performance computing', aside = TRUE)`</span> (HPC) cluster is often preferable.</span>
<span id="cb82-360"><a href="#cb82-360" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref_pkg("batchtools")`</span> provides a framework to simplify running large batches of computational experiments in parallel from R on such sites.</span>
<span id="cb82-361"><a href="#cb82-361" aria-hidden="true" tabindex="-1"></a>It is highly flexible, making it suitable for a wide range of computational experiments, including machine learning, optimization, simulation, and more.</span>
<span id="cb82-362"><a href="#cb82-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-363"><a href="#cb82-363" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb82-364"><a href="#cb82-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## `"batchtools"` backend for `future`</span></span>
<span id="cb82-365"><a href="#cb82-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-366"><a href="#cb82-366" aria-hidden="true" tabindex="-1"></a>In @sec-parallel-resample we touched upon different parallelization backends.</span>
<span id="cb82-367"><a href="#cb82-367" aria-hidden="true" tabindex="-1"></a>The package <span class="in">`r ref_pkg("future")`</span> includes a <span class="in">`"batchtools"`</span> plan, however, this does not allow the additional control that comes with working with <span class="in">`batchtools`</span> directly.</span>
<span id="cb82-368"><a href="#cb82-368" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-369"><a href="#cb82-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-370"><a href="#cb82-370" aria-hidden="true" tabindex="-1"></a>An HPC cluster is a collection of interconnected computers or servers providing computational power beyond what a single computer can achieve.</span>
<span id="cb82-371"><a href="#cb82-371" aria-hidden="true" tabindex="-1"></a>HPC clusters typically consist of multiple compute nodes, each with multiple CPU/GPU cores, memory, and local storage.</span>
<span id="cb82-372"><a href="#cb82-372" aria-hidden="true" tabindex="-1"></a>These nodes are usually connected by a high-speed network and network file system which enables the nodes to communicate and work together on a given task.</span>
<span id="cb82-373"><a href="#cb82-373" aria-hidden="true" tabindex="-1"></a>The most important difference between HPC clusters and a personal computer (PC), is that the nodes often cannot be accessed directly, but instead, computational jobs are queued by a <span class="in">`r index("scheduling system")`</span> such as Slurm (Simple Linux Utility for Resource Management).</span>
<span id="cb82-374"><a href="#cb82-374" aria-hidden="true" tabindex="-1"></a>A scheduling system is a software tool that orchestrates the allocation of computing resources to users or applications on the cluster.</span>
<span id="cb82-375"><a href="#cb82-375" aria-hidden="true" tabindex="-1"></a>It ensures that multiple users and applications can access the resources of the cluster fairly and efficiently, and also helps to maximize the utilization of the computing resources.</span>
<span id="cb82-376"><a href="#cb82-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-377"><a href="#cb82-377" aria-hidden="true" tabindex="-1"></a>@fig-hpc contains a rough sketch of an HPC architecture.</span>
<span id="cb82-378"><a href="#cb82-378" aria-hidden="true" tabindex="-1"></a>Multiple users can log into the head node (typically via SSH) and add their <span class="in">`r index('computational job')`</span>s to the queue by sending a command of the form "execute computation X using resources Y for Z amount of time".</span>
<span id="cb82-379"><a href="#cb82-379" aria-hidden="true" tabindex="-1"></a>The scheduling system controls when these computational jobs are executed.</span>
<span id="cb82-380"><a href="#cb82-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-381"><a href="#cb82-381" aria-hidden="true" tabindex="-1"></a>For the rest of this section, we will look at how to use <span class="in">`batchtools`</span> and <span class="in">`r mlr3batchmark`</span> for submitting jobs, adapting jobs to clusters, ensuring reproducibility, querying job status, and debugging failures.</span>
<span id="cb82-382"><a href="#cb82-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-383"><a href="#cb82-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-026, echo = FALSE}</span></span>
<span id="cb82-384"><a href="#cb82-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-hpc</span></span>
<span id="cb82-385"><a href="#cb82-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Illustration of an HPC cluster architecture."</span></span>
<span id="cb82-386"><a href="#cb82-386" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "Flow diagram of objects. Left is a laptop with an arrow to an object that says 'Head Node - Scheduler', the arrow has text 'SSH'. The scheduler has a bidirectional arrow with text 'Submit' to 'Queue' that has an arrow to 'Computing Nodes'. The scheduler also has an arrow to 'File System' which has a double arrow connecting it to/from the 'Computing Nodes' object with text 'Data'."</span></span>
<span id="cb82-387"><a href="#cb82-387" aria-hidden="true" tabindex="-1"></a><span class="fu">include_multi_graphics</span>(<span class="st">"mlr3book_figures-32"</span>)</span>
<span id="cb82-388"><a href="#cb82-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-389"><a href="#cb82-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-390"><a href="#cb82-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### Experiment Registry Setup {#sec-registry}</span></span>
<span id="cb82-391"><a href="#cb82-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-392"><a href="#cb82-392" aria-hidden="true" tabindex="-1"></a><span class="in">`batchtools`</span>\index{\texttt{batchtools}} is built around experiments or '<span class="in">`r index("jobs")`</span>'.</span>
<span id="cb82-393"><a href="#cb82-393" aria-hidden="true" tabindex="-1"></a>One replication of a job is defined by applying a (parameterized) algorithm to a (parameterized) problem.</span>
<span id="cb82-394"><a href="#cb82-394" aria-hidden="true" tabindex="-1"></a>A benchmark experiment in <span class="in">`batchtools`</span> consists of running many such experiments with different algorithms, algorithm parameters, problems, and problem parameters.</span>
<span id="cb82-395"><a href="#cb82-395" aria-hidden="true" tabindex="-1"></a>Each such experiment is computationally independent of all other experiments and constitutes the basic level of computation <span class="in">`batchtools`</span> can parallelize.</span>
<span id="cb82-396"><a href="#cb82-396" aria-hidden="true" tabindex="-1"></a>For this section, we will define a single <span class="in">`batchtools`</span> experiment as one resampling iteration of one learner on one task, in @sec-custom-experiments we will look at different ways of defining an experiment.</span>
<span id="cb82-397"><a href="#cb82-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-398"><a href="#cb82-398" aria-hidden="true" tabindex="-1"></a>The first step in running an experiment is to create or load an experiment registry with <span class="in">`r ref("makeExperimentRegistry()")`</span> or <span class="in">`r ref("loadRegistry()")`</span> respectively.</span>
<span id="cb82-399"><a href="#cb82-399" aria-hidden="true" tabindex="-1"></a>This constructs the inter-communication object for all functions in <span class="in">`batchtools`</span> and corresponds to a folder on the file system.</span>
<span id="cb82-400"><a href="#cb82-400" aria-hidden="true" tabindex="-1"></a>Among other things, the experiment registry stores the algorithms, problems, and job definitions; log outputs and status of submitted, running, and finished jobs; job results; and the "cluster function" that defines the interaction with the scheduling system in a scheduling-software-agnostic way.</span>
<span id="cb82-401"><a href="#cb82-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-402"><a href="#cb82-402" aria-hidden="true" tabindex="-1"></a>Below, we create a registry in a subdirectory of our working directory -- on a real cluster, make sure that this folder is stored on a shared network filesystem, otherwise, the nodes cannot access it.</span>
<span id="cb82-403"><a href="#cb82-403" aria-hidden="true" tabindex="-1"></a>We also set the registry's <span class="in">`seed`</span> to <span class="in">`1`</span> and the <span class="in">`packages`</span> to <span class="in">`"mlr3verse"`</span>, which will make these packages available in all our experiments.</span>
<span id="cb82-404"><a href="#cb82-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-405"><a href="#cb82-405" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb82-406"><a href="#cb82-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-407"><a href="#cb82-407" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(<span class="st">"experiments"</span>)) {</span>
<span id="cb82-408"><a href="#cb82-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="st">"experiments"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-409"><a href="#cb82-409" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-410"><a href="#cb82-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-411"><a href="#cb82-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-412"><a href="#cb82-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-027, message=FALSE, warning=FALSE}</span></span>
<span id="cb82-413"><a href="#cb82-413" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-414"><a href="#cb82-414" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(batchtools)</span>
<span id="cb82-415"><a href="#cb82-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-416"><a href="#cb82-416" aria-hidden="true" tabindex="-1"></a><span class="co"># create registry</span></span>
<span id="cb82-417"><a href="#cb82-417" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">=</span> <span class="fu">makeExperimentRegistry</span>(</span>
<span id="cb82-418"><a href="#cb82-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">file.dir =</span> <span class="st">"./experiments"</span>,</span>
<span id="cb82-419"><a href="#cb82-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb82-420"><a href="#cb82-420" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="st">"mlr3verse"</span></span>
<span id="cb82-421"><a href="#cb82-421" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-422"><a href="#cb82-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-423"><a href="#cb82-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-424"><a href="#cb82-424" aria-hidden="true" tabindex="-1"></a>Once the registry has been created, we need to populate it with problems and algorithms to form the jobs, this is most easily carried out with <span class="in">`mlr3batchmark`</span>\index{\texttt{mlr3batchmark}}, although finer control is possible with <span class="in">`batchtools`</span> and will be explored in @sec-custom-experiments.</span>
<span id="cb82-425"><a href="#cb82-425" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("batchmark()", aside = TRUE)`</span> converts <span class="in">`mlr3`</span> tasks and resamplings to <span class="in">`batchtools`</span> problems, and converts <span class="in">`mlr3`</span> learners to <span class="in">`batchtools`</span> algorithms; jobs are then created for all resampling iterations.</span>
<span id="cb82-426"><a href="#cb82-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-427"><a href="#cb82-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-029}</span></span>
<span id="cb82-428"><a href="#cb82-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-429"><a href="#cb82-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb82-430"><a href="#cb82-430" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3batchmark)</span>
<span id="cb82-431"><a href="#cb82-431" aria-hidden="true" tabindex="-1"></a><span class="fu">batchmark</span>(large_design, <span class="at">reg =</span> reg)</span>
<span id="cb82-432"><a href="#cb82-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-433"><a href="#cb82-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-434"><a href="#cb82-434" aria-hidden="true" tabindex="-1"></a>Now the registry includes six problems, one for each resampled task, and $180$ jobs from $3$ learners $\times$ $6$ tasks $\times$ $10$ resampling iterations.</span>
<span id="cb82-435"><a href="#cb82-435" aria-hidden="true" tabindex="-1"></a>The single algorithm in the registry is because <span class="in">`mlr3batchmark`</span> specifies a single algorithm that is parametrized with the learner IDs.</span>
<span id="cb82-436"><a href="#cb82-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-437"><a href="#cb82-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-438"><a href="#cb82-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-030}</span></span>
<span id="cb82-439"><a href="#cb82-439" aria-hidden="true" tabindex="-1"></a>reg</span>
<span id="cb82-440"><a href="#cb82-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-441"><a href="#cb82-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-442"><a href="#cb82-442" aria-hidden="true" tabindex="-1"></a>By default, the "Interactive" cluster function (see <span class="in">`r ref("makeClusterFunctionsInteractive()")`</span>) is used -- this is the abstraction for the scheduling system, and "interactive" here means to not use a real scheduler but instead to use the interactive R session for sequential computation.</span>
<span id="cb82-443"><a href="#cb82-443" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("getJobTable()")`</span> can be used to get more detailed information about the jobs.</span>
<span id="cb82-444"><a href="#cb82-444" aria-hidden="true" tabindex="-1"></a>Here, we only show a few selected columns for readability and unpack the list columns <span class="in">`algo.pars`</span> and <span class="in">`prob.pars`</span> using <span class="in">`r ref("unwrap()")`</span>.</span>
<span id="cb82-445"><a href="#cb82-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-446"><a href="#cb82-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-032}</span></span>
<span id="cb82-447"><a href="#cb82-447" aria-hidden="true" tabindex="-1"></a>job_table <span class="ot">=</span> <span class="fu">getJobTable</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-448"><a href="#cb82-448" aria-hidden="true" tabindex="-1"></a>job_table <span class="ot">=</span> <span class="fu">unwrap</span>(job_table)</span>
<span id="cb82-449"><a href="#cb82-449" aria-hidden="true" tabindex="-1"></a>job_table <span class="ot">=</span> job_table[,</span>
<span id="cb82-450"><a href="#cb82-450" aria-hidden="true" tabindex="-1"></a>  .(job.id, learner_id, task_id, resampling_id, repl)</span>
<span id="cb82-451"><a href="#cb82-451" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb82-452"><a href="#cb82-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-453"><a href="#cb82-453" aria-hidden="true" tabindex="-1"></a>job_table</span>
<span id="cb82-454"><a href="#cb82-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-455"><a href="#cb82-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-456"><a href="#cb82-456" aria-hidden="true" tabindex="-1"></a>In this output, we can see how each job is now assigned a unique <span class="in">`job.id`</span> and that each row corresponds to a single iteration (column <span class="in">`repl`</span>) of a resample experiment.</span>
<span id="cb82-457"><a href="#cb82-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-458"><a href="#cb82-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Job Submission {#sec-batchtools-submission}</span></span>
<span id="cb82-459"><a href="#cb82-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-460"><a href="#cb82-460" aria-hidden="true" tabindex="-1"></a>With the experiments defined, we can now submit them to the cluster.</span>
<span id="cb82-461"><a href="#cb82-461" aria-hidden="true" tabindex="-1"></a>However, it is best practice to first test each algorithm individually using <span class="in">`r ref("testJob()", aside = TRUE)`</span>.</span>
<span id="cb82-462"><a href="#cb82-462" aria-hidden="true" tabindex="-1"></a>By example, we will only test the first job (<span class="in">`id = 1`</span>) and will use an external R session (<span class="in">`external = TRUE`</span>).</span>
<span id="cb82-463"><a href="#cb82-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-464"><a href="#cb82-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-033}</span></span>
<span id="cb82-465"><a href="#cb82-465" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb82-466"><a href="#cb82-466" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">testJob</span>(<span class="dv">1</span>, <span class="at">external =</span> <span class="cn">TRUE</span>, <span class="at">reg =</span> reg)</span>
<span id="cb82-467"><a href="#cb82-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-468"><a href="#cb82-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-469"><a href="#cb82-469" aria-hidden="true" tabindex="-1"></a>Once we are confident that the jobs are defined correctly (see @sec-batchtools-monitoring for jobs with errors), we can proceed with their submission, by specifying the resource requirements for each computational job and then optionally grouping jobs.</span>
<span id="cb82-470"><a href="#cb82-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-471"><a href="#cb82-471" aria-hidden="true" tabindex="-1"></a>Configuration of resources is dependent on the cluster function set in the registry.</span>
<span id="cb82-472"><a href="#cb82-472" aria-hidden="true" tabindex="-1"></a>We will assume we are working with a <span class="in">`r index('Slurm', lower = FALSE)`</span> cluster and accordingly initialize the cluster function with <span class="in">`r ref("makeClusterFunctionsSlurm()")`</span> and will make use of the <span class="in">`slurm-simple.tml`</span> template file that can be found in a subdirectory of the <span class="in">`batchtools`</span> package itself (the exact location can be found by running <span class="in">`system.file("templates", package = "batchtools")`</span>), or the <span class="in">`batchtools`</span> GitHub repository.</span>
<span id="cb82-473"><a href="#cb82-473" aria-hidden="true" tabindex="-1"></a>A template file is a shell script with placeholders filled in by <span class="in">`batchtools`</span> and contains the command to start the computation via <span class="in">`Rscript`</span> or <span class="in">`R CMD batch`</span>, as well as comments which serve as annotations for the scheduler, for example, to communicate resources or paths on the file system.</span>
<span id="cb82-474"><a href="#cb82-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-475"><a href="#cb82-475" aria-hidden="true" tabindex="-1"></a>The exemplary template should work on many Slurm installations out-of-the-box, but you might have to modify it for your cluster -- it can be customized to work with more advanced configurations.</span>
<span id="cb82-476"><a href="#cb82-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-477"><a href="#cb82-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-034}</span></span>
<span id="cb82-478"><a href="#cb82-478" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">=</span> <span class="fu">makeClusterFunctionsSlurm</span>(<span class="at">template =</span> <span class="st">"slurm-simple"</span>)</span>
<span id="cb82-479"><a href="#cb82-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-482"><a href="#cb82-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-483"><a href="#cb82-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb82-484"><a href="#cb82-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-485"><a href="#cb82-485" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">=</span> <span class="fu">makeClusterFunctionsInteractive</span>()</span>
<span id="cb82-486"><a href="#cb82-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-487"><a href="#cb82-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-488"><a href="#cb82-488" aria-hidden="true" tabindex="-1"></a>To proceed with the examples on a local machine, we recommend setting the cluster function to a Socket backend with <span class="in">`r ref("makeClusterFunctionsSocket()")`</span>.</span>
<span id="cb82-489"><a href="#cb82-489" aria-hidden="true" tabindex="-1"></a>The chosen cluster function can be saved to the registry by passing it to the <span class="in">`$cluster.functions`</span> field.</span>
<span id="cb82-490"><a href="#cb82-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-491"><a href="#cb82-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-036, output = FALSE}</span></span>
<span id="cb82-492"><a href="#cb82-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-493"><a href="#cb82-493" aria-hidden="true" tabindex="-1"></a>reg<span class="sc">$</span>cluster.functions <span class="ot">=</span> cf</span>
<span id="cb82-494"><a href="#cb82-494" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRegistry</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-495"><a href="#cb82-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-496"><a href="#cb82-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-497"><a href="#cb82-497" aria-hidden="true" tabindex="-1"></a>With the registry setup, we can now decide if we want to run the experiments in chunks (@sec-parallelization) and then specify the resource requirements for the submitted jobs.</span>
<span id="cb82-498"><a href="#cb82-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-499"><a href="#cb82-499" aria-hidden="true" tabindex="-1"></a>For this example, we will use <span class="in">`r ref("chunk()", aside = TRUE)`</span> to <span class="in">`r index('chunk')`</span> the jobs such that five iterations of one resample experiment are run sequentially in one computational job -- in practice the optimal grouping will be highly dependent on your experiment (@sec-parallelization).</span>
<span id="cb82-500"><a href="#cb82-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-501"><a href="#cb82-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-037}</span></span>
<span id="cb82-502"><a href="#cb82-502" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> job_table<span class="sc">$</span>job.id</span>
<span id="cb82-503"><a href="#cb82-503" aria-hidden="true" tabindex="-1"></a>chunks <span class="ot">=</span> <span class="fu">data.table</span>(</span>
<span id="cb82-504"><a href="#cb82-504" aria-hidden="true" tabindex="-1"></a>  <span class="at">job.id =</span> ids, <span class="at">chunk =</span> <span class="fu">chunk</span>(ids, <span class="at">chunk.size =</span> <span class="dv">5</span>, <span class="at">shuffle =</span> <span class="cn">FALSE</span>)</span>
<span id="cb82-505"><a href="#cb82-505" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-506"><a href="#cb82-506" aria-hidden="true" tabindex="-1"></a>chunks[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>] <span class="co"># first 6 jobs</span></span>
<span id="cb82-507"><a href="#cb82-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-508"><a href="#cb82-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-509"><a href="#cb82-509" aria-hidden="true" tabindex="-1"></a>The final step is to decide the resource requirements for each job.</span>
<span id="cb82-510"><a href="#cb82-510" aria-hidden="true" tabindex="-1"></a>The set of resources depends on your cluster and the corresponding template file.</span>
<span id="cb82-511"><a href="#cb82-511" aria-hidden="true" tabindex="-1"></a>If you are unsure about the resource requirements, you can start a subset of jobs with liberal resource constraints, e.g. the maximum runtime allowed for your computing site.</span>
<span id="cb82-512"><a href="#cb82-512" aria-hidden="true" tabindex="-1"></a>Measured runtimes and memory usage can later be queried with <span class="in">`r ref("getJobTable()")`</span> and used to better estimate the required resources for the remaining jobs.</span>
<span id="cb82-513"><a href="#cb82-513" aria-hidden="true" tabindex="-1"></a>In this example we will set the number of CPUs per job to <span class="in">`1`</span>, the walltime (time limit before jobs are stopped by the scheduler) to one hour (<span class="in">`3600`</span> seconds), and the RAM limit (memory limit before jobs are stopped by the scheduler) to <span class="in">`8000`</span> megabytes.</span>
<span id="cb82-514"><a href="#cb82-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-517"><a href="#cb82-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-518"><a href="#cb82-518" aria-hidden="true" tabindex="-1"></a>resources <span class="ot">=</span> <span class="fu">list</span>(<span class="at">ncpus =</span> <span class="dv">1</span>, <span class="at">walltime =</span> <span class="dv">3600</span>, <span class="at">memory =</span> <span class="dv">8000</span>)</span>
<span id="cb82-519"><a href="#cb82-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-520"><a href="#cb82-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-521"><a href="#cb82-521" aria-hidden="true" tabindex="-1"></a>With all the elements in place, we can now submit our jobs.</span>
<span id="cb82-522"><a href="#cb82-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-523"><a href="#cb82-523" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- output to false otherwise we see the interactive cluster function --&gt;</span></span>
<span id="cb82-524"><a href="#cb82-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-038, output = FALSE}</span></span>
<span id="cb82-525"><a href="#cb82-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-526"><a href="#cb82-526" aria-hidden="true" tabindex="-1"></a><span class="fu">submitJobs</span>(<span class="at">ids =</span> chunks, <span class="at">resources =</span> resources, <span class="at">reg =</span> reg)</span>
<span id="cb82-527"><a href="#cb82-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-528"><a href="#cb82-528" aria-hidden="true" tabindex="-1"></a><span class="co"># wait for all jobs to terminate</span></span>
<span id="cb82-529"><a href="#cb82-529" aria-hidden="true" tabindex="-1"></a><span class="fu">waitForJobs</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-530"><a href="#cb82-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-531"><a href="#cb82-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-532"><a href="#cb82-532" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb82-533"><a href="#cb82-533" aria-hidden="true" tabindex="-1"></a><span class="fu">## Submitting Jobs</span></span>
<span id="cb82-534"><a href="#cb82-534" aria-hidden="true" tabindex="-1"></a>A good approach to submit computational jobs is by using a persistent R session (e.g., with Terminal Multiplexer (TMUX)) on the head node to continue job submission (or computation, depending on the cluster functions) in the background.</span>
<span id="cb82-535"><a href="#cb82-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-536"><a href="#cb82-536" aria-hidden="true" tabindex="-1"></a>However, <span class="in">`batchtools`</span> registries are saved to the file system and therefore persistent when the R session is terminated.</span>
<span id="cb82-537"><a href="#cb82-537" aria-hidden="true" tabindex="-1"></a>This means that you can also submit jobs from an interactive R session, terminate the session, and analyze the results later in a new session.</span>
<span id="cb82-538"><a href="#cb82-538" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-539"><a href="#cb82-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-540"><a href="#cb82-540" aria-hidden="true" tabindex="-1"></a><span class="fu">###  Job Monitoring, Error Handling, and Result Collection {#sec-batchtools-monitoring}</span></span>
<span id="cb82-541"><a href="#cb82-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-542"><a href="#cb82-542" aria-hidden="true" tabindex="-1"></a>Once jobs have been submitted, they can then be queried with <span class="in">`r ref("getStatus()", aside = TRUE)`</span> to find their current status and the results (or errors) can be investigated.</span>
<span id="cb82-543"><a href="#cb82-543" aria-hidden="true" tabindex="-1"></a>If you terminated your R sessions after job submission, you can load the experiment registry with <span class="in">`r ref("loadRegistry()", aside = TRUE)`</span>.</span>
<span id="cb82-544"><a href="#cb82-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-545"><a href="#cb82-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-041}</span></span>
<span id="cb82-546"><a href="#cb82-546" aria-hidden="true" tabindex="-1"></a><span class="fu">getStatus</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-547"><a href="#cb82-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-548"><a href="#cb82-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-549"><a href="#cb82-549" aria-hidden="true" tabindex="-1"></a>To query the ids of jobs in the respective categories, see <span class="in">`r ref("findJobs()")`</span> and, e.g., <span class="in">`r ref("findNotSubmitted()")`</span> or <span class="in">`r ref("findDone()")`</span>.</span>
<span id="cb82-550"><a href="#cb82-550" aria-hidden="true" tabindex="-1"></a>In our case, we can see all experiments finished and none expired (i.e., were removed from the queue without ever starting, <span class="in">`Expired : 0`</span>) or crashed (<span class="in">`Error : 0`</span>).</span>
<span id="cb82-551"><a href="#cb82-551" aria-hidden="true" tabindex="-1"></a>It can still be sensible to use <span class="in">`r ref("grepLogs()")`</span> to check the logs for suspicious messages and warnings before proceeding with the analysis of the results.</span>
<span id="cb82-552"><a href="#cb82-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-553"><a href="#cb82-553" aria-hidden="true" tabindex="-1"></a>In any large-scale experiment many things can and will go wrong, for example, the cluster might have an outage, jobs may run into resource limits or crash, or there could be bugs in your code.</span>
<span id="cb82-554"><a href="#cb82-554" aria-hidden="true" tabindex="-1"></a>In these situations, it is important to quickly determine what went wrong and to recompute only the minimal number of required jobs.</span>
<span id="cb82-555"><a href="#cb82-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-556"><a href="#cb82-556" aria-hidden="true" tabindex="-1"></a>To see <span class="in">`r index('debugging')`</span> in practice we will use the debug learner (see @sec-error-handling) with a 50% probability of erroring in training.</span>
<span id="cb82-557"><a href="#cb82-557" aria-hidden="true" tabindex="-1"></a>When calling <span class="in">`r ref("batchmark()")`</span> again, the new experiments will be added to the registry on top of the existing jobs.</span>
<span id="cb82-558"><a href="#cb82-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-559"><a href="#cb82-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, output = FALSE}</span></span>
<span id="cb82-560"><a href="#cb82-560" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-561"><a href="#cb82-561" aria-hidden="true" tabindex="-1"></a>extra_design <span class="ot">=</span> <span class="fu">benchmark_grid</span>(tasks,</span>
<span id="cb82-562"><a href="#cb82-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lrn</span>(<span class="st">"classif.debug"</span>, <span class="at">error_train =</span> <span class="fl">0.5</span>), resamplings, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-563"><a href="#cb82-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-564"><a href="#cb82-564" aria-hidden="true" tabindex="-1"></a><span class="fu">batchmark</span>(extra_design, <span class="at">reg =</span> reg)</span>
<span id="cb82-565"><a href="#cb82-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-566"><a href="#cb82-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-567"><a href="#cb82-567" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb82-568"><a href="#cb82-568" aria-hidden="true" tabindex="-1"></a><span class="fu">## Registry Argument</span></span>
<span id="cb82-569"><a href="#cb82-569" aria-hidden="true" tabindex="-1"></a>All <span class="in">`batchtools`</span> functions that interoperate with a registry take a registry as an argument.</span>
<span id="cb82-570"><a href="#cb82-570" aria-hidden="true" tabindex="-1"></a>By default, this argument is set to the last created registry, which is currently the <span class="in">`reg`</span> object defined earlier.</span>
<span id="cb82-571"><a href="#cb82-571" aria-hidden="true" tabindex="-1"></a>We pass it explicitly in this section for clarity.</span>
<span id="cb82-572"><a href="#cb82-572" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb82-573"><a href="#cb82-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-574"><a href="#cb82-574" aria-hidden="true" tabindex="-1"></a>Now we can get the IDs of the new jobs (which have not been submitted yet) and submit them by passing their IDs.</span>
<span id="cb82-575"><a href="#cb82-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-576"><a href="#cb82-576" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, output = FALSE}</span></span>
<span id="cb82-577"><a href="#cb82-577" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-578"><a href="#cb82-578" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> <span class="fu">findNotSubmitted</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-579"><a href="#cb82-579" aria-hidden="true" tabindex="-1"></a><span class="fu">submitJobs</span>(ids, <span class="at">reg =</span> reg)</span>
<span id="cb82-580"><a href="#cb82-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-581"><a href="#cb82-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-582"><a href="#cb82-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb82-583"><a href="#cb82-583" aria-hidden="true" tabindex="-1"></a><span class="fu">waitForJobs</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-584"><a href="#cb82-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-585"><a href="#cb82-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-586"><a href="#cb82-586" aria-hidden="true" tabindex="-1"></a>After these jobs have terminated, we can get a summary of those that failed:</span>
<span id="cb82-587"><a href="#cb82-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-590"><a href="#cb82-590" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-591"><a href="#cb82-591" aria-hidden="true" tabindex="-1"></a><span class="fu">getStatus</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-592"><a href="#cb82-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-593"><a href="#cb82-593" aria-hidden="true" tabindex="-1"></a>error_ids <span class="ot">=</span> <span class="fu">findErrors</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-594"><a href="#cb82-594" aria-hidden="true" tabindex="-1"></a><span class="fu">summarizeExperiments</span>(error_ids, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"task_id"</span>, <span class="st">"learner_id"</span>),</span>
<span id="cb82-595"><a href="#cb82-595" aria-hidden="true" tabindex="-1"></a>  <span class="at">reg =</span> reg)</span>
<span id="cb82-596"><a href="#cb82-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-597"><a href="#cb82-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-598"><a href="#cb82-598" aria-hidden="true" tabindex="-1"></a>In a real experiment, we would now investigate the debug learner further to understand why it errored, try to fix those bugs, and then potentially rerun those experiments only.</span>
<span id="cb82-599"><a href="#cb82-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-600"><a href="#cb82-600" aria-hidden="true" tabindex="-1"></a>Assuming learners have been debugged (or we are happy to ignore them), we can then collect the results of our experiment with <span class="in">`r ref("mlr3batchmark::reduceResultsBatchmark()")`</span>, which constructs a <span class="in">`r ref("BenchmarkResult")`</span> from the results.</span>
<span id="cb82-601"><a href="#cb82-601" aria-hidden="true" tabindex="-1"></a>Below we filter out results from the debug learner.</span>
<span id="cb82-602"><a href="#cb82-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-605"><a href="#cb82-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb82-606"><a href="#cb82-606" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> <span class="fu">findExperiments</span>(<span class="at">algo.pars =</span> learner_id <span class="sc">!=</span> <span class="st">"classif.debug"</span>,</span>
<span id="cb82-607"><a href="#cb82-607" aria-hidden="true" tabindex="-1"></a>  <span class="at">reg =</span> reg)</span>
<span id="cb82-608"><a href="#cb82-608" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">=</span> <span class="fu">reduceResultsBatchmark</span>(ids, <span class="at">reg =</span> reg)</span>
<span id="cb82-609"><a href="#cb82-609" aria-hidden="true" tabindex="-1"></a>bmr<span class="sc">$</span><span class="fu">aggregate</span>()[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb82-610"><a href="#cb82-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-611"><a href="#cb82-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-612"><a href="#cb82-612" aria-hidden="true" tabindex="-1"></a><span class="fu">### Custom Experiments with batchtools {#sec-custom-experiments}</span></span>
<span id="cb82-613"><a href="#cb82-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-614"><a href="#cb82-614" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_optional.qmd &gt;}}</span>
<span id="cb82-615"><a href="#cb82-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-616"><a href="#cb82-616" aria-hidden="true" tabindex="-1"></a>In general, we recommend using <span class="in">`mlr3batchmark`</span> for scheduling simpler <span class="in">`mlr3`</span> jobs on an HPC, however, we will also briefly show you how to use <span class="in">`batchtools`</span> without <span class="in">`mlr3batchmark`</span> for finer control over your experiment.</span>
<span id="cb82-617"><a href="#cb82-617" aria-hidden="true" tabindex="-1"></a>Again we start by creating an experiment registry.</span>
<span id="cb82-618"><a href="#cb82-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-619"><a href="#cb82-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include = FALSE}</span></span>
<span id="cb82-620"><a href="#cb82-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-621"><a href="#cb82-621" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">dir.exists</span>(<span class="st">"experiments-custom"</span>)) {</span>
<span id="cb82-622"><a href="#cb82-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlink</span>(<span class="st">"experiments-custom"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-623"><a href="#cb82-623" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-624"><a href="#cb82-624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-625"><a href="#cb82-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-626"><a href="#cb82-626" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-046, message = FALSE}</span></span>
<span id="cb82-627"><a href="#cb82-627" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-628"><a href="#cb82-628" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">=</span> <span class="fu">makeExperimentRegistry</span>(</span>
<span id="cb82-629"><a href="#cb82-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">file.dir =</span> <span class="st">"./experiments-custom"</span>,</span>
<span id="cb82-630"><a href="#cb82-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1</span>,</span>
<span id="cb82-631"><a href="#cb82-631" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="st">"mlr3verse"</span></span>
<span id="cb82-632"><a href="#cb82-632" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-633"><a href="#cb82-633" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-634"><a href="#cb82-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-635"><a href="#cb82-635" aria-hidden="true" tabindex="-1"></a>"Problems" are then manually registered with <span class="in">`r ref("addProblem()")`</span>.</span>
<span id="cb82-636"><a href="#cb82-636" aria-hidden="true" tabindex="-1"></a>In this example, we will register all task-resampling combinations of the <span class="in">`large_design`</span> above using the task ids as unique names.</span>
<span id="cb82-637"><a href="#cb82-637" aria-hidden="true" tabindex="-1"></a>We specify that the <span class="in">`data`</span> for the problem (i.e., the static data that is trained/tested by the learner) is the task/resampling pair.</span>
<span id="cb82-638"><a href="#cb82-638" aria-hidden="true" tabindex="-1"></a>Finally, we pass a function (<span class="in">`fun`</span>, dynamic problem part) that takes in the static problem <span class="in">`data`</span> and returns it as the problem <span class="in">`instance`</span> without making changes (@fig-batchtools-illustration).</span>
<span id="cb82-639"><a href="#cb82-639" aria-hidden="true" tabindex="-1"></a>The <span class="in">`fun`</span> shown below is the default behavior and could be omitted, we show it here for clarity.</span>
<span id="cb82-640"><a href="#cb82-640" aria-hidden="true" tabindex="-1"></a>This function could be more complex and take further parameters to modify the problem instance dynamically.</span>
<span id="cb82-641"><a href="#cb82-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-642"><a href="#cb82-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-047, output = FALSE}</span></span>
<span id="cb82-643"><a href="#cb82-643" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-644"><a href="#cb82-644" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(tasks)) {</span>
<span id="cb82-645"><a href="#cb82-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProblem</span>(</span>
<span id="cb82-646"><a href="#cb82-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> tasks[[i]]<span class="sc">$</span>id,</span>
<span id="cb82-647"><a href="#cb82-647" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="at">task =</span> tasks[[i]], <span class="at">resampling =</span> resamplings[[i]]),</span>
<span id="cb82-648"><a href="#cb82-648" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> <span class="cf">function</span>(data, job, ...) data,</span>
<span id="cb82-649"><a href="#cb82-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg =</span> reg</span>
<span id="cb82-650"><a href="#cb82-650" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb82-651"><a href="#cb82-651" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-652"><a href="#cb82-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-653"><a href="#cb82-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-654"><a href="#cb82-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-655"><a href="#cb82-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-051, echo = FALSE}</span></span>
<span id="cb82-656"><a href="#cb82-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-batchtools-illustration</span></span>
<span id="cb82-657"><a href="#cb82-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Illustration of a batchtools problem, algorithm, and experiment. "</span></span>
<span id="cb82-658"><a href="#cb82-658" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "The diagram shows a rectangle that says 'static problem part, data', with an arrow pointing to 'dynamic problem function, fun(data, ...)' and 'algorithm function, fun(data, instance, ...)'. A box that says 'problem design, (addExperiments)' also has an arrow to the 'dynamic...' box. The 'dynamic...' box then has an arrow with text 'instance' that points to the 'algorithm function' box. A box that says 'algorithm design, (addExperiments)' also points to the 'algorithm function' box. Finally the 'algorithm function' box points to 'result'."</span></span>
<span id="cb82-659"><a href="#cb82-659" aria-hidden="true" tabindex="-1"></a><span class="fu">include_multi_graphics</span>(<span class="st">"mlr3book_figures-31"</span>)</span>
<span id="cb82-660"><a href="#cb82-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-661"><a href="#cb82-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-662"><a href="#cb82-662" aria-hidden="true" tabindex="-1"></a>Next, we need to specify the algorithm to run with <span class="in">`r ref("addAlgorithm()")`</span>.</span>
<span id="cb82-663"><a href="#cb82-663" aria-hidden="true" tabindex="-1"></a>Algorithms are again specified with a unique <span class="in">`name`</span>, as well as a function to define the computational steps of the experiment and to return its result.</span>
<span id="cb82-664"><a href="#cb82-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-665"><a href="#cb82-665" aria-hidden="true" tabindex="-1"></a>Here, we define one job to represent a complete resample experiment.</span>
<span id="cb82-666"><a href="#cb82-666" aria-hidden="true" tabindex="-1"></a>In general, algorithms in <span class="in">`batchtools`</span> may return arbitrary objects -- those are simply stored on the file system and can be processed with a custom function while collecting the results.</span>
<span id="cb82-667"><a href="#cb82-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-668"><a href="#cb82-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-048, message=FALSE}</span></span>
<span id="cb82-669"><a href="#cb82-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-670"><a href="#cb82-670" aria-hidden="true" tabindex="-1"></a><span class="fu">addAlgorithm</span>(</span>
<span id="cb82-671"><a href="#cb82-671" aria-hidden="true" tabindex="-1"></a>  <span class="st">"run_learner"</span>,</span>
<span id="cb82-672"><a href="#cb82-672" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> <span class="cf">function</span>(instance, learner, job, ...) {</span>
<span id="cb82-673"><a href="#cb82-673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resample</span>(instance<span class="sc">$</span>task, learner, instance<span class="sc">$</span>resampling)</span>
<span id="cb82-674"><a href="#cb82-674" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb82-675"><a href="#cb82-675" aria-hidden="true" tabindex="-1"></a>  <span class="at">reg =</span> reg</span>
<span id="cb82-676"><a href="#cb82-676" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-677"><a href="#cb82-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-678"><a href="#cb82-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-679"><a href="#cb82-679" aria-hidden="true" tabindex="-1"></a>Finally, we will define concrete experiments with <span class="in">`r ref("addExperiments()")`</span> by passing problem designs (<span class="in">`prob.designs`</span>) and algorithm designs (<span class="in">`algo.designs`</span>) that assign parameters to problems and algorithms, respectively (@fig-batchtools-illustration).</span>
<span id="cb82-680"><a href="#cb82-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-681"><a href="#cb82-681" aria-hidden="true" tabindex="-1"></a>In the code below, we add all resampling iterations for the six tasks as experiments.</span>
<span id="cb82-682"><a href="#cb82-682" aria-hidden="true" tabindex="-1"></a>By leaving <span class="in">`prob.designs`</span> unspecified, experiments for all existing problems are created per default.</span>
<span id="cb82-683"><a href="#cb82-683" aria-hidden="true" tabindex="-1"></a>We set the <span class="in">`learner`</span> parameter of our algorithm (<span class="in">`"run_learner"`</span>) to be the three learners from our <span class="in">`large_design`</span> object.</span>
<span id="cb82-684"><a href="#cb82-684" aria-hidden="true" tabindex="-1"></a>Note that whenever an experiment is added, the current seed is assigned to the experiment and then incremented.</span>
<span id="cb82-685"><a href="#cb82-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-686"><a href="#cb82-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-049, eval = FALSE}</span></span>
<span id="cb82-687"><a href="#cb82-687" aria-hidden="true" tabindex="-1"></a>alg_des <span class="ot">=</span> <span class="fu">list</span>(<span class="at">run_learner =</span> <span class="fu">data.table</span>(<span class="at">learner =</span> learners))</span>
<span id="cb82-688"><a href="#cb82-688" aria-hidden="true" tabindex="-1"></a><span class="fu">addExperiments</span>(<span class="at">algo.designs =</span> alg_des, <span class="at">reg =</span> reg)</span>
<span id="cb82-689"><a href="#cb82-689" aria-hidden="true" tabindex="-1"></a><span class="fu">summarizeExperiments</span>()</span>
<span id="cb82-690"><a href="#cb82-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-691"><a href="#cb82-691" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE, output = FALSE}</span></span>
<span id="cb82-692"><a href="#cb82-692" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-693"><a href="#cb82-693" aria-hidden="true" tabindex="-1"></a>alg_des <span class="ot">=</span> <span class="fu">list</span>(<span class="at">run_learner =</span> <span class="fu">data.table</span>(<span class="at">learner =</span> learners))</span>
<span id="cb82-694"><a href="#cb82-694" aria-hidden="true" tabindex="-1"></a><span class="fu">addExperiments</span>(<span class="at">algo.designs =</span> alg_des, <span class="at">reg =</span> reg)</span>
<span id="cb82-695"><a href="#cb82-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-696"><a href="#cb82-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE, output = TRUE}</span></span>
<span id="cb82-697"><a href="#cb82-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-698"><a href="#cb82-698" aria-hidden="true" tabindex="-1"></a><span class="fu">summarizeExperiments</span>()</span>
<span id="cb82-699"><a href="#cb82-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-700"><a href="#cb82-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-701"><a href="#cb82-701" aria-hidden="true" tabindex="-1"></a>Our jobs can now be submitted to the cluster; by not specifying specific job IDs, *all* experiments are submitted.</span>
<span id="cb82-702"><a href="#cb82-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-703"><a href="#cb82-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, output = FALSE}</span></span>
<span id="cb82-704"><a href="#cb82-704" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-705"><a href="#cb82-705" aria-hidden="true" tabindex="-1"></a><span class="fu">submitJobs</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-706"><a href="#cb82-706" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-707"><a href="#cb82-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-708"><a href="#cb82-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb82-709"><a href="#cb82-709" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb82-710"><a href="#cb82-710" aria-hidden="true" tabindex="-1"></a><span class="fu">waitForJobs</span>(<span class="at">reg =</span> reg)</span>
<span id="cb82-711"><a href="#cb82-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-712"><a href="#cb82-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-713"><a href="#cb82-713" aria-hidden="true" tabindex="-1"></a>We can retrieve the job results using <span class="in">`r ref("loadResult()")`</span>, which outputs the objects returned by the algorithm function, which in our case is a <span class="in">`r ref("ResampleResult")`</span>.</span>
<span id="cb82-714"><a href="#cb82-714" aria-hidden="true" tabindex="-1"></a>To retrieve all results at once, we can use <span class="in">`r ref("reduceResults()")`</span> to create a single <span class="in">`r ref("BenchmarkResult")`</span>.</span>
<span id="cb82-715"><a href="#cb82-715" aria-hidden="true" tabindex="-1"></a>For this, we use the combine function <span class="in">`c()`</span> which can combine multiple objects of type <span class="in">`ResampleResult`</span> or <span class="in">`BenchmarkResult`</span> to a single <span class="in">`BenchmarkResult`</span>.</span>
<span id="cb82-716"><a href="#cb82-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-717"><a href="#cb82-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-054}</span></span>
<span id="cb82-718"><a href="#cb82-718" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">=</span> <span class="fu">loadResult</span>(<span class="dv">1</span>, <span class="at">reg =</span> reg)</span>
<span id="cb82-719"><a href="#cb82-719" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(rr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb82-720"><a href="#cb82-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-721"><a href="#cb82-721" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">=</span> <span class="fu">reduceResults</span>(c, <span class="at">reg =</span> reg)</span>
<span id="cb82-722"><a href="#cb82-722" aria-hidden="true" tabindex="-1"></a>bmr<span class="sc">$</span><span class="fu">aggregate</span>()[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb82-723"><a href="#cb82-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-724"><a href="#cb82-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-725"><a href="#cb82-725" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical Analysis {#sec-benchmark-analysis}</span></span>
<span id="cb82-726"><a href="#cb82-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-727"><a href="#cb82-727" aria-hidden="true" tabindex="-1"></a>The final step of a benchmarking experiment is to use statistical tests to determine which (if any) of our learners performed the best.</span>
<span id="cb82-728"><a href="#cb82-728" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("mlr3benchmark")`</span> provides infrastructure for applying statistical significance tests on <span class="in">`r ref("BenchmarkResult")`</span> objects.</span>
<span id="cb82-729"><a href="#cb82-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-730"><a href="#cb82-730" aria-hidden="true" tabindex="-1"></a>Currently, <span class="in">`r index('Friedman')`</span> tests and pairwise Friedman-Nemenyi tests <span class="co">[</span><span class="ot">@demsar2006</span><span class="co">]</span> are supported to analyze benchmark experiments with at least two independent tasks and at least two learners.</span>
<span id="cb82-731"><a href="#cb82-731" aria-hidden="true" tabindex="-1"></a>As a first step, we recommend performing a pairwise comparison of learners using pairwise Friedman-Nemenyi tests with <span class="in">`$friedman_posthoc()`</span>.</span>
<span id="cb82-732"><a href="#cb82-732" aria-hidden="true" tabindex="-1"></a>This method first performs a global comparison to see if any learner is statistically better than another.</span>
<span id="cb82-733"><a href="#cb82-733" aria-hidden="true" tabindex="-1"></a>To use these methods we first convert the benchmark result to a <span class="in">`r ref("BenchmarkAggr")`</span> object using <span class="in">`r ref("as_benchmark_aggr()", aside = TRUE)`</span>.</span>
<span id="cb82-734"><a href="#cb82-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-735"><a href="#cb82-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-056}</span></span>
<span id="cb82-736"><a href="#cb82-736" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3benchmark)</span>
<span id="cb82-737"><a href="#cb82-737" aria-hidden="true" tabindex="-1"></a>bma <span class="ot">=</span> <span class="fu">as_benchmark_aggr</span>(bmr, <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>))</span>
<span id="cb82-738"><a href="#cb82-738" aria-hidden="true" tabindex="-1"></a>bma<span class="sc">$</span><span class="fu">friedman_posthoc</span>()</span>
<span id="cb82-739"><a href="#cb82-739" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-740"><a href="#cb82-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-741"><a href="#cb82-741" aria-hidden="true" tabindex="-1"></a>These results indicate a statistically significant difference between the <span class="in">`"featureless"`</span> learner and <span class="in">`"ranger"`</span> (assuming $p\leq0.05$ is significant).</span>
<span id="cb82-742"><a href="#cb82-742" aria-hidden="true" tabindex="-1"></a>This table can be visualized in a critical difference plot (@fig-lsb-cd), which typically shows the mean rank of a learning algorithm on the x-axis along with a thick horizontal line that connects learners that are pairwise not significantly different (while correcting for multiple tests).</span>
<span id="cb82-743"><a href="#cb82-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-744"><a href="#cb82-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r large_benchmarking-057, fig.height = 1.5}</span></span>
<span id="cb82-745"><a href="#cb82-745" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lsb-cd</span></span>
<span id="cb82-746"><a href="#cb82-746" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Critical difference diagram comparing the random forest, logistic regression, and featureless baseline. The critical difference of 1.35 in the title refers to the difference in mean rank required to conclude that one learner performs statistically different to another."</span></span>
<span id="cb82-747"><a href="#cb82-747" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: "Figure shows a one-axis diagram ranging from 0 to 4, above the diagram is a thick black line with text 'Critical Difference = 1.35'. Diagram shows 'ranger' on the far left just to the right of '1', then 'logreg' just to the left of '2', then 'featureless' just under '3'. There is a thick, black line connecting 'ranger' and 'logreg', as well as a thick, black line connecting 'logreg' and 'featureless'."</span></span>
<span id="cb82-748"><a href="#cb82-748" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bma, <span class="at">type =</span> <span class="st">"cd"</span>, <span class="at">ratio =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb82-749"><a href="#cb82-749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb82-750"><a href="#cb82-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-751"><a href="#cb82-751" aria-hidden="true" tabindex="-1"></a>Using @fig-lsb-cd we can conclude that on average the random forest had the lowest (i.e., best) rank, followed by the logistic regression, and then the featureless baseline.</span>
<span id="cb82-752"><a href="#cb82-752" aria-hidden="true" tabindex="-1"></a>While the random forest was statistically better performing than the baseline (no connecting line in @fig-lsb-cd), it was not statistically superior to the logistic regression (connecting line in @fig-lsb-cd).</span>
<span id="cb82-753"><a href="#cb82-753" aria-hidden="true" tabindex="-1"></a>We could now further compare this with the large benchmark study conducted by @couronne2018random, where the random forest outperformed the logistic regression in 69% of 243 real-world datasets.</span>
<span id="cb82-754"><a href="#cb82-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-755"><a href="#cb82-755" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb82-756"><a href="#cb82-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-757"><a href="#cb82-757" aria-hidden="true" tabindex="-1"></a>In this chapter, we have explored how to conduct large-scale machine learning experiments using <span class="in">`mlr3`</span>.</span>
<span id="cb82-758"><a href="#cb82-758" aria-hidden="true" tabindex="-1"></a>We have shown how to acquire diverse datasets from OpenML through the <span class="in">`r mlr3oml`</span> interface package, how to execute large-scale experiments with <span class="in">`batchtools`</span> and <span class="in">`r mlr3batchmark`</span> integration, and finally how to analyze the results of these experiments with <span class="in">`r mlr3benchmark`</span>.</span>
<span id="cb82-759"><a href="#cb82-759" aria-hidden="true" tabindex="-1"></a>For further reading about <span class="in">`r ref_pkg("batchtools")`</span> we recommend @batchtools and @JSSv064i11.</span>
<span id="cb82-760"><a href="#cb82-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-761"><a href="#cb82-761" aria-hidden="true" tabindex="-1"></a>| Class | Constructor/Function | Fields/Methods |</span>
<span id="cb82-762"><a href="#cb82-762" aria-hidden="true" tabindex="-1"></a>| --- | --- | --- |</span>
<span id="cb82-763"><a href="#cb82-763" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("OMLData")`</span> | <span class="in">`r ref("odt()")`</span> | <span class="in">`$data`</span>; <span class="in">`$feature_names`</span> |</span>
<span id="cb82-764"><a href="#cb82-764" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("OMLTask")`</span> | <span class="in">`r ref("otsk()")`</span> | <span class="in">`$data`</span>; <span class="in">`$task_splits`</span> |</span>
<span id="cb82-765"><a href="#cb82-765" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("OMLCollection")`</span> | <span class="in">`r ref("ocl()")`</span> | <span class="in">`$task_ids`</span> |</span>
<span id="cb82-766"><a href="#cb82-766" aria-hidden="true" tabindex="-1"></a>| <span class="in">`Registry`</span> | <span class="in">`r ref("makeExperimentRegistry()")`</span> | <span class="in">`r ref("submitJobs()")`</span>; <span class="in">`r ref("getStatus()")`</span>; <span class="in">`r ref("reduceResultsBatchmark")`</span>; <span class="in">`r ref("getJobTable")`</span> |</span>
<span id="cb82-767"><a href="#cb82-767" aria-hidden="true" tabindex="-1"></a>| | <span class="in">`r ref("batchmark()")`</span> | - |</span>
<span id="cb82-768"><a href="#cb82-768" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("BenchmarkAggr()")`</span> | <span class="in">`r ref("as_benchmark_aggr()")`</span> | <span class="in">`$friedman_posthoc()`</span> |</span>
<span id="cb82-769"><a href="#cb82-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-770"><a href="#cb82-770" aria-hidden="true" tabindex="-1"></a>: Important classes and functions covered in this chapter with underlying class (if applicable), class constructor or function, and important class fields and methods (if applicable). {#tbl-api-large-benchmarking}</span>
<span id="cb82-771"><a href="#cb82-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-772"><a href="#cb82-772" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb82-773"><a href="#cb82-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-774"><a href="#cb82-774" aria-hidden="true" tabindex="-1"></a>In these exercises, we will conduct an empirical study analyzing whether a random forest is predictively stronger than a single decision tree.</span>
<span id="cb82-775"><a href="#cb82-775" aria-hidden="true" tabindex="-1"></a>  Our null hypothesis is that there is no significant performance difference.</span>
<span id="cb82-776"><a href="#cb82-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-777"><a href="#cb82-777" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Load the OpenML collection with ID 269, which contains regression tasks from the AutoML benchmark <span class="co">[</span><span class="ot">@amlb2022</span><span class="co">]</span>.</span>
<span id="cb82-778"><a href="#cb82-778" aria-hidden="true" tabindex="-1"></a>  Peek into this suite to study the contained data sets and their characteristics.</span>
<span id="cb82-779"><a href="#cb82-779" aria-hidden="true" tabindex="-1"></a>  Then find all tasks with less than 4000 observations and convert them to <span class="in">`mlr3`</span> tasks.</span>
<span id="cb82-780"><a href="#cb82-780" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Create an experimental design that compares <span class="in">`lrn("regr.ranger")`</span> and <span class="in">`lrn("regr.rpart")`</span> on those tasks.</span>
<span id="cb82-781"><a href="#cb82-781" aria-hidden="true" tabindex="-1"></a>  Use the robustify pipeline for both learners and a featureless fallback learner.</span>
<span id="cb82-782"><a href="#cb82-782" aria-hidden="true" tabindex="-1"></a>  You can use three-fold CV instead of the OpenML resamplings to save time.</span>
<span id="cb82-783"><a href="#cb82-783" aria-hidden="true" tabindex="-1"></a>  Run the comparison experiments with <span class="in">`batchtools`</span>.</span>
<span id="cb82-784"><a href="#cb82-784" aria-hidden="true" tabindex="-1"></a>  Use default hyperparameter settings and do not perform any tuning to keep the experiments simple.</span>
<span id="cb82-785"><a href="#cb82-785" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Conduct a global Friedman test and, if appropriate, post hoc Friedman-Nemenyi tests, and interpret the results.</span>
<span id="cb82-786"><a href="#cb82-786" aria-hidden="true" tabindex="-1"></a>  As an evaluation measure, use the MSE.</span>
<span id="cb82-787"><a href="#cb82-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-788"><a href="#cb82-788" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb82-789"><a href="#cb82-789" aria-hidden="true" tabindex="-1"></a><span class="in">`r citeas(chapter)`</span></span>
<span id="cb82-790"><a href="#cb82-790" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Bernd Bischl, Raphael Sonabend, Lars Kotthoff, Michel Lang.</div>   
    <div class="nav-footer-center"><a href="https://mlr-org.com">Website</a> | <a href="https://github.com/mlr-org/mlr3book">GitHub</a> | <a href="https://mlr-org.com/gallery">Gallery</a> | <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">Mattermost</a></div>
    <div class="nav-footer-right">Built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>